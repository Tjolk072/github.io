<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  
  <meta name="docker_version" content="1.6.1">
  <meta name="docker_git_branch" content="master">
  <meta name="docker_git_commit" content="59cd467">
  <meta name="docker_build_date" content="Fri Jun  5 11:40:50 UTC 2015">

  <meta name="description" content="How to use Docker Compose's "extends" keyword to share configuration between files and projects">
  <meta name="keywords" content="fig, composition, compose, docker, orchestration, documentation, docs">
  
  <link rel="canonical" href="/compose/extends/">
  <link href="/css/bootstrap-custom.css" rel="stylesheet">
  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/prettify-1.0.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/dockerfile_tutorial.css">
  <link href="/tipuesearch
/tipuesearch.css" rel="stylesheet">
  <link href="/css/docs.css" rel="stylesheet">
  <link rel="shortcut icon" href="/img/favicon.png">
  <title>&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp; Extend Compose services - Docker Documentation</title>
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
  <![endif]-->
  
  <script type="text/javascript">
	  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
	  analytics.load("IWj9D0UpZHZdZUZX9jl98PcpBFWBnBMy");
	  analytics.page();
	  }}();
	</script>
  
</head>
<body>

<div id="topmostnav" class="topmostnav_loggedout navbar navbar-static-top">
  <div class="container">
    <a href="/" title="Docker Docs Home"><div class="brand logo"><img src="/img/nav/docker-logo-loggedin.png"> </div></a>
    <form id="nav_search" class="navbar-index-search pull-right" action="/jsearch/">
      <span role="status" aria-live="polite" class="ui-helper-hidden-accessible"></span>
      <input name="q" id="tipue_search_input" type="text" class="search_input search-query ui-autocomplete-input" placeholder="Search the Docs" autocomplete="off">
    </form>
    <ul class="nav">
      <li class=""><a href="http://www.docker.com/whatisdocker/" title="What is Docker">What is Docker?</a></li>
      <li class=""><a href="http://www.docker.com/resources/usecases/" title="Use Cases">Use Cases</a></li>
      <li class=""><a href="http://www.docker.com/tryit/" title="Try It!">Try It!</a></li>
      <li><a href="https://registry.hub.docker.com" title="Browse">Browse</a></li>
    </ul>
    <div id="usernav" class="pull-right">
      <a href="https://hub.docker.com/account/login" class="btn nav-button2" title="Lg In">Log In</a>
      <a href="https://hub.docker.com/account/signup" class="btn nav-button1" title="Sign Up">Sign Up</a>
    </div>
  </div>
</div>
<div id="topmostnav" class="topmostnav_loggedin navbar navbar-static-top">
  <div class="container">
    <a href="/" title="Docker Docs Home"><div class="brand logo"><img src="/img/nav/docker-logo-loggedin.png"> </div></a>
    <form id="nav_search" class="navbar-index-search pull-right" action="/jsearch/">
      <span role="status" aria-live="polite" class="ui-helper-hidden-accessible"></span>
      <input name="q" id="tipue_search_input" type="text" class="search_input search-query ui-autocomplete-input" placeholder="Search the Docs" autocomplete="off">
    </form>
    <ul class="nav">
      <li><a href="https://registry.hub.docker.com" title="Browse Repos">Browse Repos</a></li>
      <li class="active"><a href="http://docs.docker.com" title="Documentation">Documentation</a></li>
      <li><a href="http://www.docker.com/community/participate/" title="Community">Community</a></li>
      <li><a href="http://www.docker.com/resources/help/" title="Help">Help</a></li>
    </ul>
    <div id="usernav" class="pull-right">
      <ul class="nav user">
        <li class="dropdown">
          <a id="logged-in-header-username" class="dropdown-toggle" data-toggle="dropdown" href="#">
            <img class="profile" src="" alt="profile picture">
          </a>
          <ul class="dropdown-menu pull-right">
            <li><a href="https://hub.docker.com/">View Profile</a></li>
            <li><a href="https://hub.docker.com/account/settings/">Settings</a></li>
            <li><a href="https://hub.docker.com/repos/">My Repositories</a></li>
            <li><a href="https://hub.docker.com/plans/billing-info">Billing</a></li>
            <li><a href="https://hub.docker.com/account/logout/?next=/">Log out</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>

<div id="wrap">
  <nav id="nav_menu" class="clearfix navbar navbar-default navbar-static-top affix" role="navigation">
  <div id="docsnav">
    <ul id="main-nav" class="pull-left">
      
      
      <li class="dd_menu pull-left">
        
        <a href="/">About</a>
        
        <ul class="dd_submenu" style="max-height: 75px;">
        
          <li >
            <a href="/">Docker</a>
          </li>
        
          <li >
            <a href="/release-notes/">Release Notes</a>
          </li>
        
          <li >
            <a href="/introduction/understanding-docker/">Understanding Docker</a>
          </li>
        
        </ul>
      </li>
      
      
      
      <li class="dd_menu pull-left">
        
        <a href="/installation/ubuntulinux/">Installation</a>
        
        <ul class="dd_submenu" style="max-height: 75px;">
        
          <li >
            <a href="/installation/ubuntulinux/">Ubuntu</a>
          </li>
        
          <li >
            <a href="/installation/mac/">Mac OS X</a>
          </li>
        
          <li >
            <a href="/kitematic/">Kitematic on OS X</a>
          </li>
        
          <li >
            <a href="/installation/windows/">Microsoft Windows</a>
          </li>
        
          <li >
            <a href="/installation/testing-windows-docker-client/">Building and testing the Windows Docker client</a>
          </li>
        
          <li >
            <a href="/installation/amazon/">Amazon EC2</a>
          </li>
        
          <li >
            <a href="/installation/archlinux/">Arch Linux</a>
          </li>
        
          <li >
            <a href="/installation/binaries/">Binaries</a>
          </li>
        
          <li >
            <a href="/installation/centos/">CentOS</a>
          </li>
        
          <li >
            <a href="/installation/cruxlinux/">CRUX Linux</a>
          </li>
        
          <li >
            <a href="/installation/debian/">Debian</a>
          </li>
        
          <li >
            <a href="/installation/fedora/">Fedora</a>
          </li>
        
          <li >
            <a href="/installation/frugalware/">FrugalWare</a>
          </li>
        
          <li >
            <a href="/installation/google/">Google Cloud Platform</a>
          </li>
        
          <li >
            <a href="/installation/gentoolinux/">Gentoo</a>
          </li>
        
          <li >
            <a href="/installation/softlayer/">IBM Softlayer</a>
          </li>
        
          <li >
            <a href="/installation/joyent/">Joyent Compute Service</a>
          </li>
        
          <li >
            <a href="/installation/azure/">Microsoft Azure</a>
          </li>
        
          <li >
            <a href="/installation/rackspace/">Rackspace Cloud</a>
          </li>
        
          <li >
            <a href="/installation/rhel/">Red Hat Enterprise Linux</a>
          </li>
        
          <li >
            <a href="/installation/oracle/">Oracle Linux</a>
          </li>
        
          <li >
            <a href="/installation/SUSE/">SUSE</a>
          </li>
        
          <li >
            <a href="/compose/install/">Docker Compose</a>
          </li>
        
        </ul>
      </li>
      
      
      
      <li class="dd_menu pull-left active">
        
        <a href="/userguide/">User Guide</a>
        
        <ul class="dd_submenu" style="max-height: 75px;">
        
          <li >
            <a href="/userguide/">The Docker User Guide</a>
          </li>
        
          <li >
            <a href="/userguide/dockerhub/">Getting Started with Docker Hub</a>
          </li>
        
          <li >
            <a href="/userguide/dockerizing/">Dockerizing Applications</a>
          </li>
        
          <li >
            <a href="/userguide/usingdocker/">Working with Containers</a>
          </li>
        
          <li >
            <a href="/userguide/dockerimages/">Working with Docker Images</a>
          </li>
        
          <li >
            <a href="/userguide/dockerlinks/">Linking containers together</a>
          </li>
        
          <li >
            <a href="/userguide/dockervolumes/">Managing data in containers</a>
          </li>
        
          <li >
            <a href="/userguide/labels-custom-metadata/">Apply custom metadata</a>
          </li>
        
          <li >
            <a href="/userguide/dockerrepos/">Working with Docker Hub</a>
          </li>
        
          <li >
            <a href="/compose/">Docker Compose</a>
          </li>
        
          <li >
            <a href="/compose/production/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp; Use Compose in production</a>
          </li>
        
          <li class="active">
            <a href="/compose/extends/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp; Extend Compose services</a>
          </li>
        
          <li >
            <a href="/machine/">Docker Machine</a>
          </li>
        
          <li >
            <a href="/swarm/">Docker Swarm</a>
          </li>
        
          <li >
            <a href="/kitematic/userguide/">Kitematic</a>
          </li>
        
        </ul>
      </li>
      
      
      
      <li class="dd_menu pull-left">
        
        <a href="/docker-hub/">Docker Hub</a>
        
        <ul class="dd_submenu" style="max-height: 75px;">
        
          <li >
            <a href="/docker-hub/">Docker Hub</a>
          </li>
        
          <li >
            <a href="/docker-hub/accounts/">Accounts</a>
          </li>
        
          <li >
            <a href="/docker-hub/userguide/">User Guide</a>
          </li>
        
          <li >
            <a href="/docker-hub/repos/">Your Repositories</a>
          </li>
        
          <li >
            <a href="/docker-hub/builds/">Automated Builds</a>
          </li>
        
          <li >
            <a href="/docker-hub/official_repos/">Official Repositories</a>
          </li>
        
        </ul>
      </li>
      
      
      
      <li class="dd_menu pull-left">
        
        <a href="/docker-hub-enterprise/">Docker Hub Enterprise</a>
        
        <ul class="dd_submenu" style="max-height: 75px;">
        
          <li >
            <a href="/docker-hub-enterprise/">Overview</a>
          </li>
        
          <li >
            <a href="/docker-hub-enterprise/quick-start/">Quick Start: Basic Workflow</a>
          </li>
        
          <li >
            <a href="/docker-hub-enterprise/userguide/">User Guide</a>
          </li>
        
          <li >
            <a href="/docker-hub-enterprise/adminguide/">Admin Guide</a>
          </li>
        
          <li >
            <a href="/docker-hub-enterprise/install/">&nbsp;&nbsp;Installation</a>
          </li>
        
          <li >
            <a href="/docker-hub-enterprise/configuration/">&nbsp;&nbsp;Configuration options</a>
          </li>
        
          <li >
            <a href="/docker-hub-enterprise/support/">Support</a>
          </li>
        
          <li >
            <a href="/docker-hub-enterprise/release-notes/">Release notes</a>
          </li>
        
        </ul>
      </li>
      
      
      
      <li class="dd_menu pull-left">
        
        <a href="/examples/nodejs_web_app/">Examples</a>
        
        <ul class="dd_submenu" style="max-height: 75px;">
        
          <li >
            <a href="/examples/nodejs_web_app/">Dockerizing a Node.js web application</a>
          </li>
        
          <li >
            <a href="/examples/mongodb/">Dockerizing MongoDB</a>
          </li>
        
          <li >
            <a href="/examples/running_redis_service/">Dockerizing a Redis service</a>
          </li>
        
          <li >
            <a href="/examples/postgresql_service/">Dockerizing a PostgreSQL service</a>
          </li>
        
          <li >
            <a href="/examples/running_riak_service/">Dockerizing a Riak service</a>
          </li>
        
          <li >
            <a href="/examples/running_ssh_service/">Dockerizing an SSH service</a>
          </li>
        
          <li >
            <a href="/examples/couchdb_data_volumes/">Dockerizing a CouchDB service</a>
          </li>
        
          <li >
            <a href="/examples/apt-cacher-ng/">Dockerizing an Apt-Cacher-ng service</a>
          </li>
        
          <li >
            <a href="/compose/django/">Getting started with Compose and Django</a>
          </li>
        
          <li >
            <a href="/compose/rails/">Getting started with Compose and Rails</a>
          </li>
        
          <li >
            <a href="/compose/wordpress/">Getting started with Compose and Wordpress</a>
          </li>
        
          <li >
            <a href="/kitematic/minecraft-server/">Kitematic: Minecraft server</a>
          </li>
        
          <li >
            <a href="/kitematic/nginx-web-server/">Kitematic: Ngnix web server</a>
          </li>
        
          <li >
            <a href="/kitematic/rethinkdb-dev-database/">Kitematic: RethinkDB development database</a>
          </li>
        
        </ul>
      </li>
      
      
      
      <li class="dd_menu pull-left">
        
        <a href="/articles/basics/">Articles</a>
        
        <ul class="dd_submenu" style="max-height: 75px;">
        
          <li >
            <a href="/articles/basics/">Docker basics</a>
          </li>
        
          <li >
            <a href="/articles/networking/">Advanced networking</a>
          </li>
        
          <li >
            <a href="/articles/security/">Security</a>
          </li>
        
          <li >
            <a href="/articles/https/">Running Docker with HTTPS</a>
          </li>
        
          <li >
            <a href="/articles/registry_mirror/">Run a local registry mirror</a>
          </li>
        
          <li >
            <a href="/articles/host_integration/">Automatically starting containers</a>
          </li>
        
          <li >
            <a href="/articles/baseimages/">Creating a base image</a>
          </li>
        
          <li >
            <a href="/articles/dockerfile_best-practices/">Best practices for writing Dockerfiles</a>
          </li>
        
          <li >
            <a href="/articles/certificates/">Using certificates for repository client verification</a>
          </li>
        
          <li >
            <a href="/articles/using_supervisord/">Using Supervisor</a>
          </li>
        
          <li >
            <a href="/articles/configuring/">Configuring Docker</a>
          </li>
        
          <li >
            <a href="/articles/cfengine_process_management/">Process management with CFEngine</a>
          </li>
        
          <li >
            <a href="/articles/puppet/">Using Puppet</a>
          </li>
        
          <li >
            <a href="/articles/chef/">Using Chef</a>
          </li>
        
          <li >
            <a href="/articles/dsc/">Using PowerShell DSC</a>
          </li>
        
          <li >
            <a href="/articles/ambassador_pattern_linking/">Cross-Host linking using ambassador containers</a>
          </li>
        
          <li >
            <a href="/articles/runmetrics/">Runtime metrics</a>
          </li>
        
          <li >
            <a href="/articles/b2d_volume_resize/">Increasing a Boot2Docker volume</a>
          </li>
        
          <li >
            <a href="/articles/systemd/">Controlling and configuring Docker using Systemd</a>
          </li>
        
        </ul>
      </li>
      
      
      
      <li class="dd_menu pull-left">
        
        <a href="/reference/commandline/cli/">Reference</a>
        
        <ul class="dd_submenu" style="max-height: 75px;">
        
          <li >
            <a href="/reference/commandline/cli/">Docker command line</a>
          </li>
        
          <li >
            <a href="/reference/builder/">Dockerfile</a>
          </li>
        
          <li >
            <a href="/faq/">FAQ</a>
          </li>
        
          <li >
            <a href="/reference/run/">Run Reference</a>
          </li>
        
          <li >
            <a href="/compose/cli/">Compose command line</a>
          </li>
        
          <li >
            <a href="/compose/yml/">Compose yml</a>
          </li>
        
          <li >
            <a href="/compose/env/">Compose ENV variables</a>
          </li>
        
          <li >
            <a href="/compose/completion/">Compose commandline completion</a>
          </li>
        
          <li >
            <a href="/swarm/discovery/">Swarm discovery</a>
          </li>
        
          <li >
            <a href="/swarm/scheduler/strategy/">Swarm strategies</a>
          </li>
        
          <li >
            <a href="/swarm/scheduler/filter/">Swarm filters</a>
          </li>
        
          <li >
            <a href="/swarm/API/">Swarm API</a>
          </li>
        
          <li >
            <a href="/registry/">Docker Registry 2.0</a>
          </li>
        
          <li >
            <a href="/registry/deploying/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp; Deploy a registry</a>
          </li>
        
          <li >
            <a href="/registry/configuration/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp; Configure a registry</a>
          </li>
        
          <li >
            <a href="/registry/storagedrivers/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp; Storage driver model</a>
          </li>
        
          <li >
            <a href="/registry/notifications/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp; Work with notifications</a>
          </li>
        
          <li >
            <a href="/registry/spec/api/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp; Registry Service API v2</a>
          </li>
        
          <li >
            <a href="/registry/spec/json/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp; JSON format</a>
          </li>
        
          <li >
            <a href="/registry/spec/auth/token/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp; Authenticate via central service</a>
          </li>
        
          <li >
            <a href="/reference/api/hub_registry_spec/">Docker Hub and Registry 1.0</a>
          </li>
        
          <li >
            <a href="/reference/api/registry_api/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp;Docker Registry API v1</a>
          </li>
        
          <li >
            <a href="/reference/api/registry_api_client_libraries/">&nbsp;&nbsp;&nbsp;&nbsp;&blacksquare;&nbsp;Docker Registry 1.0 API Client Libraries</a>
          </li>
        
          <li >
            <a href="/reference/api/docker-io_api/">Docker Hub API</a>
          </li>
        
          <li >
            <a href="/reference/api/docker_remote_api/">Docker Remote API</a>
          </li>
        
          <li >
            <a href="/reference/api/docker_remote_api_v1.18/">Docker Remote API v1.18</a>
          </li>
        
          <li >
            <a href="/reference/api/docker_remote_api_v1.17/">Docker Remote API v1.17</a>
          </li>
        
          <li >
            <a href="/reference/api/docker_remote_api_v1.16/">Docker Remote API v1.16</a>
          </li>
        
          <li >
            <a href="/reference/api/remote_api_client_libraries/">Docker Remote API client libraries</a>
          </li>
        
          <li >
            <a href="/reference/api/docker_io_accounts_api/">Docker Hub accounts API</a>
          </li>
        
          <li >
            <a href="/kitematic/faq/">Kitematic: FAQ</a>
          </li>
        
          <li >
            <a href="/kitematic/known-issues/">Kitematic: Known issues</a>
          </li>
        
        </ul>
      </li>
      
      
      
      <li class="dd_menu pull-left">
        
        <a href="/project/who-written-for/">Contributor</a>
        
        <ul class="dd_submenu" style="max-height: 75px;">
        
          <li >
            <a href="/project/who-written-for/">README first</a>
          </li>
        
          <li >
            <a href="/project/software-required/">Get required software for Linux or OS X</a>
          </li>
        
          <li >
            <a href="/project/software-req-win/">Get required software for Windows</a>
          </li>
        
          <li >
            <a href="/project/set-up-git/">Configure Git for contributing</a>
          </li>
        
          <li >
            <a href="/project/set-up-dev-env/">Work with a development container</a>
          </li>
        
          <li >
            <a href="/project/test-and-docs/">Run tests and test documentation</a>
          </li>
        
          <li >
            <a href="/project/make-a-contribution/">Understand contribution workflow</a>
          </li>
        
          <li >
            <a href="/project/find-an-issue/">Find an issue</a>
          </li>
        
          <li >
            <a href="/project/work-issue/">Work on an issue</a>
          </li>
        
          <li >
            <a href="/project/create-pr/">Create a pull request</a>
          </li>
        
          <li >
            <a href="/project/review-pr/">Participate in the PR review</a>
          </li>
        
          <li >
            <a href="/project/advanced-contributing/">Advanced contributing</a>
          </li>
        
          <li >
            <a href="/project/get-help/">Where to get help</a>
          </li>
        
          <li >
            <a href="/project/coding-style/">Coding style guide</a>
          </li>
        
          <li >
            <a href="/project/doc-style/">Documentation style guide</a>
          </li>
        
        </ul>
      </li>
      
      
    </ul>
  </div>
</nav>
  <div id="content" class="container">
    <div class="row">

      <div class="span3" id="leftnav">
        <div id="toc_table">
          <ul class="nav nav-tabs nav-stacked">
            
  
    <li class=""><a href="#understand-the-extends-configuration">Understand the extends configuration</a>
      <ul>
    
      </ul>
    </li>
  
    <li class=""><a href="#example-use-case">Example use case</a>
      <ul>
    
      <li><a href="#define-the-web-app">Define the web app</a></li>
    
      <li><a href="#define-the-development-environment">Define the development environment</a></li>
    
      <li><a href="#define-the-production-environment">Define the production environment</a></li>
    
      </ul>
    </li>
  
    <li class=""><a href="#reference">Reference</a>
      <ul>
    
      <li><a href="#adding-and-overriding-configuration">Adding and overriding configuration</a></li>
    
      </ul>
    </li>
  

          </ul>
        </div>
      </div>
      <div class="span9 content-body">

        

        <h2 id="extending-services-in-compose">Extending services in Compose</h2>
<p>Docker Compose's <code>extends</code> keyword enables sharing of common configurations
among different files, or even different projects entirely. Extending services
is useful if you have several applications that reuse commonly-defined services.
Using <code>extends</code> you can define a service in one place and refer to it from
anywhere.</p>
<p>Alternatively, you can deploy the same application to multiple environments with
a slightly different set of services in each case (or with changes to the
configuration of some services). Moreover, you can do so without copy-pasting
the configuration around.</p>
<h3 id="understand-the-extends-configuration">Understand the extends configuration</h3>
<p>When defining any service in <code>docker-compose.yml</code>, you can declare that you are
extending another service like this:</p>
<pre class="prettyprint well"><code class="yaml">web:
  extends:
    file: common-services.yml
    service: webapp
</code></pre>

<p>This instructs Compose to re-use the configuration for the <code>webapp</code> service
defined in the <code>common-services.yml</code> file. Suppose that <code>common-services.yml</code>
looks like this:</p>
<pre class="prettyprint well"><code class="yaml">webapp:
  build: .
  ports:
    - &quot;8000:8000&quot;
  volumes:
    - &quot;/data&quot;
</code></pre>

<p>In this case, you'll get exactly the same result as if you wrote
<code>docker-compose.yml</code> with that <code>build</code>, <code>ports</code> and <code>volumes</code> configuration
defined directly under <code>web</code>.</p>
<p>You can go further and define (or re-define) configuration locally in
<code>docker-compose.yml</code>:</p>
<pre class="prettyprint well"><code class="yaml">web:
  extends:
    file: common-services.yml
    service: webapp
  environment:
    - DEBUG=1
  cpu_shares: 5
</code></pre>

<p>You can also write other services and link your <code>web</code> service to them:</p>
<pre class="prettyprint well"><code class="yaml">web:
  extends:
    file: common-services.yml
    service: webapp
  environment:
    - DEBUG=1
  cpu_shares: 5
  links:
    - db
db:
  image: postgres
</code></pre>

<p>For full details on how to use <code>extends</code>, refer to the <a href="#reference">reference</a>.</p>
<h3 id="example-use-case">Example use case</h3>
<p>In this example, you’ll repurpose the example app from the <a href="/compose/">quick start
guide</a>. (If you're not familiar with Compose, it's recommended that
you go through the quick start first.) This example assumes you want to use
Compose both to develop an application locally and then deploy it to a
production environment.</p>
<p>The local and production environments are similar, but there are some
differences. In development, you mount the application code as a volume so that
it can pick up changes; in production, the code should be immutable from the
outside. This ensures it’s not accidentally changed. The development environment
uses a local Redis container, but in production another team manages the Redis
service, which is listening at <code>redis-production.example.com</code>.</p>
<p>To configure with <code>extends</code> for this sample, you must:</p>
<ol>
<li>
<p>Define the web application as a Docker image in <code>Dockerfile</code> and a Compose
    service in <code>common.yml</code>.</p>
</li>
<li>
<p>Define the development environment in the standard Compose file,
    <code>docker-compose.yml</code>.</p>
<ul>
<li>Use <code>extends</code> to pull in the web service.</li>
<li>Configure a volume to enable code reloading.</li>
<li>Create an additional Redis service for the application to use locally.</li>
</ul>
</li>
<li>
<p>Define the production environment in a third Compose file, <code>production.yml</code>.</p>
<ul>
<li>Use <code>extends</code> to pull in the web service.</li>
<li>Configure the web service to talk to the external, production Redis service.</li>
</ul>
</li>
</ol>
<h4 id="define-the-web-app">Define the web app</h4>
<p>Defining the web application requires the following:</p>
<ol>
<li>
<p>Create an <code>app.py</code> file.</p>
<p>This file contains a simple Python application that uses Flask to serve HTTP
and increments a counter in Redis:</p>
<pre class="prettyprint well"><code>from flask import Flask
from redis import Redis
import os

app = Flask(__name__)
redis = Redis(host=os.environ['REDIS_HOST'], port=6379)

@app.route('/')
def hello():
   redis.incr('hits')
   return 'Hello World! I have been seen %s times.\n' % redis.get('hits')

if __name__ == "__main__":
   app.run(host="0.0.0.0", debug=True)
</code></pre>
<p>This code uses a <code>REDIS_HOST</code> environment variable to determine where to
find Redis.</p>
</li>
<li>
<p>Define the Python dependencies in a <code>requirements.txt</code> file:</p>
<pre class="prettyprint well"><code>flask
redis
</code></pre>
</li>
<li>
<p>Create a <code>Dockerfile</code> to build an image containing the app:</p>
<pre class="prettyprint well"><code>FROM python:2.7
ADD . /code
WORKDIR /code
RUN pip install -r
requirements.txt
CMD python app.py
</code></pre>
</li>
<li>
<p>Create a Compose configuration file called <code>common.yml</code>:</p>
<p>This configuration defines how to run the app.</p>
<pre class="prettyprint well"><code>web:
  build: .
  ports:
    - "5000:5000"
</code></pre>
<p>Typically, you would have dropped this configuration into
<code>docker-compose.yml</code> file, but in order to pull it into multiple files with
<code>extends</code>, it needs to be in a separate file.</p>
</li>
</ol>
<h4 id="define-the-development-environment">Define the development environment</h4>
<ol>
<li>
<p>Create a <code>docker-compose.yml</code> file.</p>
<p>The <code>extends</code> option pulls in the <code>web</code> service from the <code>common.yml</code> file
you created in the previous section.</p>
<pre class="prettyprint well"><code>web:
  extends:
    file: common.yml
    service: web
  volumes:
    - .:/code
  links:
    - redis
  environment:
    - REDIS_HOST=redis
redis:
  image: redis
</code></pre>
<p>The new addition defines a <code>web</code> service that:</p>
<ul>
<li>Fetches the base configuration for <code>web</code> out of <code>common.yml</code>.</li>
<li>Adds <code>volumes</code> and <code>links</code> configuration to the base (<code>common.yml</code>)
configuration.</li>
<li>Sets the <code>REDIS_HOST</code> environment variable to point to the linked redis
container. This environment uses a stock <code>redis</code> image from the Docker Hub.</li>
</ul>
</li>
<li>
<p>Run <code>docker-compose up</code>.</p>
<p>Compose creates, links, and starts a web and redis container linked together.
It mounts your application code inside the web container.</p>
</li>
<li>
<p>Verify that the code is mounted by changing the message in
    <code>app.py</code>&mdash;say, from <code>Hello world!</code> to <code>Hello from Compose!</code>.</p>
<p>Don't forget to refresh your browser to see the change!</p>
</li>
</ol>
<h4 id="define-the-production-environment">Define the production environment</h4>
<p>You are almost done. Now, define your production environment:</p>
<ol>
<li>
<p>Create a <code>production.yml</code> file.</p>
<p>As with <code>docker-compose.yml</code>, the <code>extends</code> option pulls in the <code>web</code> service
from <code>common.yml</code>.</p>
<pre class="prettyprint well"><code>web:
  extends:
    file: common.yml
    service: web
  environment:
    - REDIS_HOST=redis-production.example.com
</code></pre>
</li>
<li>
<p>Run <code>docker-compose -f production.yml up</code>.</p>
<p>Compose creates <em>just</em> a web container and configures the Redis connection via
the <code>REDIS_HOST</code> environment variable. This variable points to the production
Redis instance.</p>
<blockquote>
<p><strong>Note</strong>: If you try to load up the webapp in your browser you'll get an
error&mdash;<code>redis-production.example.com</code> isn't actually a Redis server.</p>
</blockquote>
</li>
</ol>
<p>You've now done a basic <code>extends</code> configuration. As your application develops,
you can make any necessary changes to the web service in <code>common.yml</code>. Compose
picks up both the development and production environments when you next run
<code>docker-compose</code>. You don't have to do any copy-and-paste, and you don't have to
manually keep both environments in sync.</p>
<h3 id="reference">Reference</h3>
<p>You can use <code>extends</code> on any service together with other configuration keys. It
always expects a dictionary that should always contain two keys: <code>file</code> and
<code>service</code>.</p>
<p>The <code>file</code> key specifies which file to look in. It can be an absolute path or a
relative one&mdash;if relative, it's treated as relative to the current file.</p>
<p>The <code>service</code> key specifies the name of the service to extend, for example <code>web</code>
or <code>database</code>.</p>
<p>You can extend a service that itself extends another. You can extend
indefinitely. Compose does not support circular references and <code>docker-compose</code>
returns an error if it encounters them.</p>
<h4 id="adding-and-overriding-configuration">Adding and overriding configuration</h4>
<p>Compose copies configurations from the original service over to the local one,
<strong>except</strong> for <code>links</code> and <code>volumes_from</code>. These exceptions exist to avoid
implicit dependencies&mdash;you always define <code>links</code> and <code>volumes_from</code>
locally. This ensures dependencies between services are clearly visible when
reading the current file. Defining these locally also ensures changes to the
referenced file don't result in breakage.</p>
<p>If a configuration option is defined in both the original service and the local
service, the local value either <em>override</em>s or <em>extend</em>s the definition of the
original service. This works differently for other configuration options.</p>
<p>For single-value options like <code>image</code>, <code>command</code> or <code>mem_limit</code>, the new value
replaces the old value. <strong>This is the default behaviour - all exceptions are
listed below.</strong></p>
<pre class="prettyprint well"><code class="yaml"># original service
command: python app.py

# local service
command: python otherapp.py

# result
command: python otherapp.py
</code></pre>

<p>In the case of <code>build</code> and <code>image</code>, using one in the local service causes
Compose to discard the other, if it was defined in the original service.</p>
<pre class="prettyprint well"><code class="yaml"># original service
build: .

# local service
image: redis

# result
image: redis
</code></pre>

<pre class="prettyprint well"><code class="yaml"># original service
image: redis

# local service
build: .

# result
build: .
</code></pre>

<p>For the <strong>multi-value options</strong> <code>ports</code>, <code>expose</code>, <code>external_links</code>, <code>dns</code> and
<code>dns_search</code>, Compose concatenates both sets of values:</p>
<pre class="prettyprint well"><code class="yaml"># original service
expose:
  - &quot;3000&quot;

# local service
expose:
  - &quot;4000&quot;
  - &quot;5000&quot;

# result
expose:
  - &quot;3000&quot;
  - &quot;4000&quot;
  - &quot;5000&quot;
</code></pre>

<p>In the case of <code>environment</code>, Compose "merges" entries together with
locally-defined values taking precedence:</p>
<pre class="prettyprint well"><code class="yaml"># original service
environment:
  - FOO=original
  - BAR=original

# local service
environment:
  - BAR=local
  - BAZ=local

# result
environment:
  - FOO=original
  - BAR=local
  - BAZ=local
</code></pre>

<p>Finally, for <code>volumes</code>, Compose "merges" entries together with locally-defined
bindings taking precedence:</p>
<pre class="prettyprint well"><code class="yaml"># original service
volumes:
  - /original-dir/foo:/foo
  - /original-dir/bar:/bar

# local service
volumes:
  - /local-dir/bar:/bar
  - /local-dir/baz/:baz

# result
volumes:
  - /original-dir/foo:/foo
  - /local-dir/bar:/bar
  - /local-dir/baz/:baz
</code></pre>


      </div>
    </div>
  </div>

  <div id="push-footer"></div>

</div>



<div id="footer-container" class="container">
  <div id="footer" class="grey-body">
    <div class="row">
      <div class="span2">
        <span class="footer-title">Community</span>
        <ul class="unstyled">
          <li><a class="primary-button" href="https://www.docker.com/community/events/">Events</a></li>
          <li><a class="primary-button" href="http://posts.docker.com">Friends' Posts</a></li>
          <li><a class="primary-button" href="https://www.docker.com/community/meetups/">Meetups</a></li>
          <li><a class="primary-button" href="https://www.docker.com/community/governance/">Governance</a></li>
          <li><a class="primary-button" href="http://forums.docker.com">Forums</a></li>
          <li><a class="primary-button" href="http://botbot.me/freenode/docker">IRC</a></li>
          <li><a class="primary-button" href="https://github.com/docker/docker">GitHub</a></li>
          <li><a class="primary-button" href="http://stackoverflow.com/search?q=docker">Stackoverflow</a></li>
          <li><a class="primary-button" href="http://www.cafepress.com/docker">Swag</a></li>
        </ul>
      </div>
      <div class="span2">
        <span class="footer-title">Enterprise</span>
        <ul class="unstyled">
          <li><a class="primary-button" href="https://www.docker.com/enterprise/support/">Support</a></li>
          <li><a class="primary-button" href="https://www.docker.com/enterprise/education/">Education</a></li>
          <li><a class="primary-button" href="https://www.docker.com/enterprise/services/">Services</a></li>
        </ul>
        <span class="footer-title">Partner Solutions</span>
        <ul class="unstyled">
          <li><a class="primary-button" href="https://www.docker.com/partners/find/">Find a Partner</a></li>
          <li><a class="primary-button" href="https://www.docker.com/partners/program/">Partner Program</a></li>
          <li><a class="primary-button" href="https://www.docker.com/partners/learn/">Learn More</a></li>
        </ul>
      </div>
      <div class="span2">
        <span class="footer-title">Resources</span>
        <ul class="unstyled">
          <li><a class="primary-button" href="https://docs.docker.com">Documentation</a></li>
          <li><a class="primary-button" href="https://www.docker.com/resources/help/">Help</a></li>
          <li><a class="primary-button" href="https://www.docker.com/resources/usecases/">Use Cases</a></li>
          <li><a class="primary-button" href="http://www.docker.com/tryit/">Online Tutorial</a></li>
          <li><a class="primary-button" href="https://www.docker.com/resources/howtobuy/">How To Buy</a></li>
          <li><a class="primary-button" href="http://status.docker.com">Status</a></li>
          <li><a class="primary-button" href="https://www.docker.com/resources/security/">Security</a></li>
        </ul>
      </div>
      <div class="span2">
        <span class="footer-title">Company</span>
        <ul class="unstyled">
          <li><a class="primary-button" href="https://www.docker.com/company/aboutus/">About Us</a></li>
          <li><a class="primary-button" href="https://www.docker.com/company/team/">Team</a></li>
          <li><a class="primary-button" href="https://www.docker.com/company/news/">News</a></li>
          <li><a class="primary-button" href="https://www.docker.com/company/press/">Press</a></li>
          <li><a class="primary-button" href="https://www.docker.com/company/careers/">Careers</a></li>
          <li><a class="primary-button" href="https://www.docker.com/company/contact/">Contact</a></li>
        </ul>
      </div>
      <div class="span3">
        <span class="footer-title">Connect</span>
        <div class="search">
          <span>Subscribe to our newsletter</span>
          <form action="https://www.docker.com/subscribe_newsletter/" method="post">
            <input type='hidden' name='csrfmiddlewaretoken' value='aWL78QXQkY8DSKNYh6cl08p5eTLl7sOa' />
            <tr><th><label for="id_email">Email:</label></th><td><input class="form-control" id="id_email" name="email" placeholder="Enter your email" type="text" /></td></tr>
            
            <button type="submit"><i class="icon-arrow-right"></i> </button>
          </form>
        </div>
        <ul class="unstyled social">
          <li><a title="Docker on Twitter" class="primary-button blog" href="http://blog.docker.com">Blog</a></li>
          <li><a title="Docker on Twitter" class="primary-button twitter" href="http://twitter.com/docker">Twitter</a></li>
          <li><a title="Docker on Google+" class="primary-button googleplus" href="https://plus.google.com/u/0/communities/108146856671494713993">Google+</a></li>
          <li><a title="Docker on Facebook" class="primary-button facebook" href="https://www.facebook.com/docker.run">Facebook</a></li>
          <li><a title="Docker on Youtube" class="primary-button youtube" href="http://www.youtube.com/user/dockerrun">YouTube</a></li>
        </ul>
        <ul class="unstyled social">
          <li><a title="Docker on SlideShare" class="primary-button slideshare" href="http://www.slideshare.net/Docker">Slideshare</a></li>
          <li>
             <a title="Docker on LinkedIn" class="primary-button" href="https://www.linkedin.com/company/docker">
                 <span class="linkedin"></span>
                 LinkedIn
             </a>
          </li>
          <li>
              <a title="Docker on GitHub" class="primary-button" href="https://github.com/docker/">
                  <span class="github"></span>
                  GitHub
              </a>
          </li>
          <li>
              <a title="Docker on Reddit" class="primary-button" href="http://www.reddit.com/r/docker">
                  <span class="reddit"></span>
                  Reddit
              </a>
          </li>
          <li>
              <a title="Docker on AngelList" class="primary-button" href="https://angel.co/docker-inc-1">
                  <span class="angellist"></span>
                  AngelList
              </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="row clearfix">
      <div class="span6 pagination-right copyright">
        <span>&copy; 2014-2015 Docker, Inc.</span>
      </div>
      <div class="span6 pagination-left copyright">
        <a href="http://www.docker.com/legal/terms_of_service">Terms</a> &middot;
        <a href="http://www.docker.com/legal/privacy_policy">Privacy</a> &middot;
        <a href="http://www.docker.com/legal/trademark_guidelines">Trademarks</a>
      </div>
    </div>
  </div>
</div>

<script src="/js/jquery-1.10.2.min.js"></script>
<script src="/js/jquery.cookie.js" ></script>
<script src="/js/jquery-scrolltofixed-min.js"></script>
<script src="/js/bootstrap-3.0.3.min.js"></script>
<script src="/js/prettify-1.0.min.js"></script>
<script src="/js/dockerfile_tutorial.js"></script>
<script src="/js/dockerfile_tutorial_level.js"></script>
<script src="/js/base.js"></script>
<script src="/tipuesearch/tipuesearch_set.js"></script>
<script src="/tipuesearch/tipuesearch.min.js"></script>
<script type="text/javascript">
piAId = '45082';
piCId = '1482';

(function() {
  function async_load(){
    var s = document.createElement('script'); s.type = 'text/javascript';
    s.src = ('https:' == document.location.protocol ? 'https://pi' : 'http://cdn') + '.pardot.com/pd.js';
    var c = document.getElementsByTagName('script')[0]; c.parentNode.insertBefore(s, c);
  }
  if(window.attachEvent) { window.attachEvent('onload', async_load); }
  else { window.addEventListener('load', async_load, false); }
})();
</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('#content').css("min-height", $(window).height() - 553 );
    // if the URL contains a version string, update the version picker to reflect that
    version = document.location.pathname.match(/^\/(v\d\.\d)\/.*/)
    if (version && version[1]) {
        $('#document-version-number')[0].text = 'Version '+version[1];
    } else {
        $('#document-version-number')[0].text = $('#document-version-number')[0].text + " (Latest)"
    }
    // load the complete versions list
    $.get("/versions.html_fragment", function( data ) {
    	$('#documentation-version-list').prepend(data);
	//remove any "/v1.1/" bits from front, so we can add the path to the version selection dropdown.
	path = document.location.pathname.replace(/^\/v\d\.\d/, "");
	$('#documentation-version-list a.version').each(function(i, e) {
		e.href = e.href+path;
		$(e).removeClass()
	});
    });

  })
  var userName = getCookie('docker_sso_username');
  if (userName) {
    $('.topmostnav_loggedout').hide();
    $('.topmostnav_loggedin').show();
    $('#logged-in-header-username').text(userName);
  } else {
    $('.topmostnav_loggedout').show();
    $('.topmostnav_loggedin').hide();
  }
</script>
</body>
</html>