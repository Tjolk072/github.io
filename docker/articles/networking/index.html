<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Network configuration </title>
     <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/dist/assets/css/bootstrap-custom.css" />
<link rel="stylesheet" href="/dist/assets/css/app.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.2.6/animate.min.css">
    <link rel="stylesheet" href="/css/custom.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script href="/dist/assets/js/modernizr.js"></script> 
</head>
<body>
  <div class="off-canvas-wrap" data-offcanvas>
    <div class="inner-wrap">

      <a class="left-off-canvas-toggle" href="#" >
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="35px" height="35px" viewBox="0 0 35 35" enable-background="new 0 0 35 35" xml:space="preserve">
          <path fill="#3597D4" d="M30.583,9.328c0,0.752-0.539,1.362-1.203,1.362H5.113c-0.664,0-1.203-0.61-1.203-1.362l0,0
          c0-0.752,0.539-1.362,1.203-1.362H29.38C30.045,7.966,30.583,8.576,30.583,9.328L30.583,9.328z"/>
          <path fill="#3597D4" d="M30.583,17.09c0,0.752-0.539,1.362-1.203,1.362H5.113c-0.664,0-1.203-0.61-1.203-1.362l0,0
          c0-0.752,0.539-1.362,1.203-1.362H29.38C30.045,15.728,30.583,16.338,30.583,17.09L30.583,17.09z"/>
          <path fill="#3597D4" d="M30.583,24.387c0,0.752-0.539,1.362-1.203,1.362H5.113c-0.664,0-1.203-0.61-1.203-1.362l0,0
          c0-0.752,0.539-1.362,1.203-1.362H29.38C30.045,23.025,30.583,23.635,30.583,24.387L30.583,24.387z"/>
        </svg>
      </a>
      <a class="button secondary small get-started-cta">Get Started</a>
      <header class="main-header">
        <div class="row">
          <div class="large-3 columns">
            <a href="/"><img class="logo" src="/dist/assets/images/logo.png"></a>
          </div>
          <div class="large-9 columns">
            <ul class="nav-global">
              <li><a href="https://www.docker.com/support">Support</a></li>
              <li><a href="https://training.docker.com/">Training</a></li>
              <li><a href="/">Docs</a></li>
              <li><a href="http://blog.docker.com/">Blog</a></li>
              <li><a href="https://hub.docker.com/account/signup/">Docker Hub</a></li>
              <li><a class="button" href="/mac/started/">Get Started</a></li>
            </ul>
            <ul class="nav-main">
              <li><a href="https://www.docker.com/products">Products</a>
                <ul>
                  <li><a href="https://www.docker.com/pricing">Pricing</a></li>
                  <li><a href="https://www.docker.com/whatisdocker">What is Docker?</a></li>
                </ul>
              </li>
              <li><a href="https://www.docker.com/customers">Customers</a></li>
              <li><a href="https://www.docker.com/community">Community</a>
                <ul>
                  <li><a href="https://www.docker.com/community/meetups">Meetups</a></li>
                  <li><a href="https://www.docker.com/community/events">Events</a></li>
                  <li><a href="https://forums.docker.com">Forums</a></li>
                  <li><a href="http://www.scoop.it/t/docker-by-docker">Community News</a></li>
                </ul>
              </li>
              <li><a href="https://www.docker.com/partners">Partners</a>
                <ul>
                  <li><a href="https://www.docker.com/partners/partner-programs">Partner Programs</a></li>
                </ul>
              </li>
              <li><a href="https://www.docker.com/company">Company</a>
                <ul>
                  <li><a href="https://www.docker.com/news-and-press">News &amp; Press</a></li>
                  <li><a href="https://www.docker.com/work-docker">Work at Docker</a></li>
                  <li><a href="https://www.docker.com/company/management">Management</a></li>
                  <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                </ul>
              </li>
              <li><a href="https://www.docker.com/open-source">Open Source</a>
                <ul>
                  <li><a href="https://www.docker.com/contribute">Contribute</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </header>

      
      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li class="has-submenu"><a href="#">Products</a>
            <ul class="left-submenu">
              <li class="back"><a href="#">Back</a></li>
              <li><a href="#">Pricing</a></li>
              <li><a href="#">What Is Docker</a></li>
              <li><a href="#">Products</a></li>
              <li><a href="#">Docker Engine</a></li>
              <li><a href="#">Docker Hub</a></li>
              <li><a href="#">Docker Registry</a></li>
              <li><a href="#">Docker Machine</a></li>
              <li><a href="#">Docker Swarm</a></li>
              <li><a href="#">Docker Compose</a></li>
              <li><a href="#">Kitematic</a></li>
            </ul>
          </li>
          <li><a href="#">Customers</a></li>
          <li class="has-submenu"><a href="#">Community</a>
            <ul class="left-submenu">
              <li class="back"><a href="#">Back</a></li>
              <li><a href="#">Community</a></li>
              <li><a href="#">Meetups</a></li>
              <li><a href="https://www.docker.com/community/events">Events</a></li>
              <li><a href="#">Forum</a></li>
              <li><a href="#">Scoop.it</a></li>
            </ul>
          </li>
          <li class="has-submenu"><a href="#">Partners</a>
            <ul class="left-submenu">
              <li class="back"><a href="#">Back</a></li>
              <li><a href="#">Partners</a></li>
              <li><a href="https://www.docker.com/partners/partner-programs">Partners Programs</a></li>
            </ul>
          </li>
          <li><a href="#">Company</a></li>
          <li class="has-submenu"><a href="#">Open Source</a>
            <ul class="left-submenu">
              <li class="back"><a href="#">Back</a></li>
              <li><a href="#">Open Source</a></li>
              <li><a href="#">Contribute</a></li>
              <li><a href="#">Governance</a></li>
            </ul>
          </li>
        </ul>
        <ul class="nav-global-off-canvas">
          <li><a href="#">Support</a></li>
          <li><a href="#">Training</a></li>
          <li><a href="#">Docs</a></li>
          <li><a href="#">Blog</a></li>
          <li><a href="#">Sign in</a></li>
          <li><a href="#">Sign up</a></li>
        </ul>
      </aside>
      
      <a class="exit-off-canvas"></a>
<div id="docs" class="row">
    <div class="large-3 columns">
        <section id="multiple" data-accordion-group>
  
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> Install</button>
          <div data-content>
            
              
                <article data-accordion>
                  <button data-control> Docker Engine</button>
                  <div data-content>
                    
                      
                        <a data-link href="/docker/installation/mac/" class=""> Installation on Mac OS X</a>
                      
                      
                    
                      
                        <a data-link href="/docker/installation/windows/" class=""> Installation on Windows</a>
                      
                      
                    
                      
                        <article data-accordion>
                          <button data-control> Linux</button>
                          <div data-content>
                            
                                <a data-link href="/docker/installation/archlinux/" class=""> Installation on Arch Linux</a>
                            
                                <a data-link href="/docker/installation/cruxlinux/" class=""> Installation on CRUX Linux</a>
                            
                                <a data-link href="/docker/installation/centos/" class=""> Installation on CentOS</a>
                            
                                <a data-link href="/docker/installation/debian/" class=""> Installation on Debian</a>
                            
                                <a data-link href="/docker/installation/fedora/" class=""> Installation on Fedora</a>
                            
                                <a data-link href="/docker/installation/frugalware/" class=""> Installation on FrugalWare</a>
                            
                                <a data-link href="/docker/installation/gentoolinux/" class=""> Installation on Gentoo</a>
                            
                                <a data-link href="/docker/installation/oracle/" class=""> Installation on Oracle Linux</a>
                            
                                <a data-link href="/docker/installation/rhel/" class=""> Installation on Red Hat Enterprise Linux</a>
                            
                                <a data-link href="/docker/installation/ubuntulinux/" class=""> Installation on Ubuntu </a>
                            
                                <a data-link href="/docker/installation/SUSE/" class=""> Installation on openSUSE and SUSE Linux Enterprise</a>
                            
                           </div>
                         </article> 
                      
                      
                    
                      
                        <article data-accordion>
                          <button data-control> Cloud</button>
                          <div data-content>
                            
                                <a data-link href="/docker/installation/amazon/" class=""> Amazon EC2 Installation</a>
                            
                                <a data-link href="/docker/installation/joyent/" class=""> Install on Joyent Public Cloud</a>
                            
                                <a data-link href="/docker/installation/google/" class=""> Installation on Google Cloud Platform</a>
                            
                                <a data-link href="/docker/installation/softlayer/" class=""> Installation on IBM SoftLayer </a>
                            
                                <a data-link href="/docker/installation/azure/" class=""> Installation on Microsoft Azure platform</a>
                            
                                <a data-link href="/docker/installation/rackspace/" class=""> Installation on Rackspace Cloud</a>
                            
                           </div>
                         </article> 
                      
                      
                    
                      
                        <a data-link href="/docker/installation/binaries/" class=""> Installation from binaries</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <a data-link href="/kitematic/" class=""> Kitematic</a>
              
            
              
                <a data-link href="/machine/install-machine/" class=""> Docker Machine</a>
              
            
              
                <a data-link href="/compose/install/" class=""> Docker Compose</a>
              
            
              
                <a data-link href="/swarm/install-w-machine/" class=""> Docker Swarm</a>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> Docker Fundamentals</button>
          <div data-content>
            
              
                <a data-link href="/docker/userguide/" class=""> The Docker user guide</a>
              
            
              
                <article data-accordion>
                  <button data-control> Work with Docker Images</button>
                  <div data-content>
                    
                      
                        <a data-link href="/articles/dockerfile_best-practices/" class=""> Best practices for writing Dockerfiles</a>
                      
                      
                    
                      
                        <a data-link href="/articles/baseimages/" class=""> Create a base image</a>
                      
                      
                    
                      
                        <a data-link href="/docker/userguide/dockerimages/" class=""> Get started with images</a>
                      
                      
                    
                      
                        <a data-link href="/docker/userguide/dockerrepos/" class=""> Get started with Docker Hub</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Work with Docker Containers</button>
                  <div data-content>
                    
                      
                        <a data-link href="/articles/basics/" class=""> Get started with containers</a>
                      
                      
                    
                      
                        <a data-link href="/docker/userguide/usingdocker/" class=""> Working with containers</a>
                      
                      
                    
                      
                        <a data-link href="/docker/userguide/dockervolumes/" class=""> Managing data in containers</a>
                      
                      
                    
                      
                        <a data-link href="/docker/userguide/dockerlinks/" class=""> Linking containers together</a>
                      
                      
                    
                      
                        <a data-link href="/articles/host_integration/" class=""> Automatically start containers</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Docker on Windows &amp; OSX</button>
                  <div data-content>
                    
                      
                        <a data-link href="/articles/dsc/" class=""> PowerShell DSC Usage</a>
                      
                      
                    
                      
                        <a data-link href="/articles/b2d_volume_resize/" class=""> Resizing a Boot2Docker volume	</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Use the Kitematic GUI</button>
                  <div data-content>
                    
                      
                        <a data-link href="/kitematic/userguide/" class=""> Kitematic User Guide: Intro &amp; Overview</a>
                      
                      
                    
                      
                        <a data-link href="/kitematic/nginx-web-server/" class=""> Set up an Nginx web server</a>
                      
                      
                    
                      
                        <a data-link href="/kitematic/minecraft-server/" class=""> Set up a Minecraft Server</a>
                      
                      
                    
                      
                        <a data-link href="/kitematic/rethinkdb-dev-database/" class=""> Creating a Local RethinkDB Database for Development</a>
                      
                      
                    
                      
                        <a data-link href="/kitematic/faq/" class=""> Frequently Asked Questions</a>
                      
                      
                    
                      
                        <a data-link href="/kitematic/known-issues/" class=""> Known Issues</a>
                      
                      
                    
                  </div>
                </article>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> Use Docker</button>
          <div data-content>
            
              
                <a data-link href="/docker/misc/" class=""> About Docker</a>
              
            
              
                <a data-link href="/docker/userguide/labels-custom-metadata/" class=""> Apply custom metadata</a>
              
            
              
                <a data-link href="/docker/introduction/understanding-docker/" class=""> Understand the architecture</a>
              
            
              
                <article data-accordion>
                  <button data-control> Provision &amp; set up Docker hosts</button>
                  <div data-content>
                    
                      
                        <a data-link href="/machine/" class=""> Overview of Docker Machine</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Create multi-container applications</button>
                  <div data-content>
                    
                      
                        <a data-link href="/compose/" class=""> Overview of Docker Compose</a>
                      
                      
                    
                      
                        <a data-link href="/compose/production/" class=""> Using Compose in production</a>
                      
                      
                    
                      
                        <a data-link href="/compose/extends/" class=""> Extending services in Compose</a>
                      
                      
                    
                      
                        <a data-link href="/compose/completion/" class=""> Command Completion</a>
                      
                      
                    
                      
                        <a data-link href="/compose/django/" class=""> Quickstart Guide: Compose and Django</a>
                      
                      
                    
                      
                        <a data-link href="/compose/rails/" class=""> Quickstart Guide: Compose and Rails</a>
                      
                      
                    
                      
                        <a data-link href="/compose/wordpress/" class=""> Quickstart Guide: Compose and Wordpress</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Cluster Docker containers</button>
                  <div data-content>
                    
                      
                        <a data-link href="/swarm/" class=""> Docker Swarm</a>
                      
                      
                    
                      
                        <a data-link href="/swarm/install-manual/" class=""> Create a swarm for development</a>
                      
                      
                    
                      
                        <a data-link href="/swarm/discovery/" class=""> Docker Swarm discovery</a>
                      
                      
                    
                      
                        <a data-link href="/swarm/scheduler/filter/" class=""> Docker Swarm filters</a>
                      
                      
                    
                      
                        <a data-link href="/swarm/scheduler/strategy/" class=""> Docker Swarm strategies</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Adminstrate Docker</button>
                  <div data-content>
                    
                      
                        <a data-link href="/articles/networking/" class=""> Network configuration</a>
                      
                      
                    
                      
                        <a data-link href="/articles/security/" class=""> Docker security</a>
                      
                      
                    
                      
                        <a data-link href="/articles/configuring/" class=""> Configuring and running Docker</a>
                      
                      
                    
                      
                        <a data-link href="/articles/runmetrics/" class=""> Runtime metrics</a>
                      
                      
                    
                      
                        <a data-link href="/articles/https/" class=""> Protect the Docker daemon socket</a>
                      
                      
                    
                      
                        <a data-link href="/articles/ambassador_pattern_linking/" class=""> Link via an ambassador container</a>
                      
                      
                    
                      
                        <a data-link href="/articles/systemd/" class=""> Control and configure Docker with systemd</a>
                      
                      
                    
                      
                        <article data-accordion>
                          <button data-control> Applications and Services</button>
                          <div data-content>
                            
                                <a data-link href="/docker/examples/running_riak_service/" class=""> Dockerizing a Riak service</a>
                            
                                <a data-link href="/docker/examples/running_ssh_service/" class=""> Dockerizing an SSH service</a>
                            
                           </div>
                         </article> 
                      
                      
                    
                      
                        <article data-accordion>
                          <button data-control> Integrate with Third-party Tools</button>
                          <div data-content>
                            
                                <a data-link href="/articles/cfengine_process_management/" class=""> Process management with CFEngine</a>
                            
                                <a data-link href="/articles/chef/" class=""> Using Chef</a>
                            
                                <a data-link href="/articles/puppet/" class=""> Using Puppet</a>
                            
                                <a data-link href="/articles/using_supervisord/" class=""> Using Supervisor with Docker</a>
                            
                           </div>
                         </article> 
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Applied Docker</button>
                  <div data-content>
                    
                      
                        <a data-link href="/docker/examples/mongodb/" class=""> Dockerizing MongoDB</a>
                      
                      
                    
                      
                        <a data-link href="/docker/examples/postgresql_service/" class=""> Dockerizing PostgreSQL</a>
                      
                      
                    
                      
                        <a data-link href="/docker/examples/couchdb_data_volumes/" class=""> Dockerizing a CouchDB service</a>
                      
                      
                    
                      
                        <a data-link href="/docker/examples/nodejs_web_app/" class=""> Dockerizing a Node.js web app</a>
                      
                      
                    
                      
                        <a data-link href="/docker/examples/running_redis_service/" class=""> Dockerizing a Redis service</a>
                      
                      
                    
                      
                        <a data-link href="/docker/examples/apt-cacher-ng/" class=""> Dockerizing an apt-cacher-ng service</a>
                      
                      
                    
                      
                        <a data-link href="/docker/userguide/dockerizing/" class=""> Dockerizing applications: A &#39;Hello world&#39;</a>
                      
                      
                    
                  </div>
                </article>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> Manage image repositories</button>
          <div data-content>
            
              
                <article data-accordion>
                  <button data-control> The Public Hub</button>
                  <div data-content>
                    
                      
                        <a data-link href="/docker/docker-hub/userguide/" class=""> Docker Hub user guide</a>
                      
                      
                    
                      
                        <a data-link href="/docker/docker-hub/" class=""> The Docker Hub</a>
                      
                      
                    
                      
                        <a data-link href="/docker/docker-hub/accounts/" class=""> Accounts on Docker Hub</a>
                      
                      
                    
                      
                        <a data-link href="/docker/userguide/dockerhub/" class=""> Getting started with Docker Hub</a>
                      
                      
                    
                      
                        <a data-link href="/docker/docker-hub/repos/" class=""> Your Repositories on Docker Hub</a>
                      
                      
                    
                      
                        <a data-link href="/docker/docker-hub/builds/" class=""> Automated Builds on Docker Hub</a>
                      
                      
                    
                      
                        <a data-link href="/docker/docker-hub/official_repos/" class=""> Official Repositories on Docker Hub</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Docker Trusted Registry</button>
                  <div data-content>
                    
                      
                        <a data-link href="/docker-trusted-registry/" class=""> Overview</a>
                      
                      
                    
                      
                        <a data-link href="/docker-trusted-registry/quick-start/" class=""> Quick-start: Basic Workflow</a>
                      
                      
                    
                      
                        <a data-link href="/docker-trusted-registry/userguide/" class=""> User guide</a>
                      
                      
                    
                      
                        <a data-link href="/docker-trusted-registry/adminguide/" class=""> Admin guide</a>
                      
                      
                    
                      
                        <a data-link href="/docker-trusted-registry/install/" class=""> Installation</a>
                      
                      
                    
                      
                        <a data-link href="/docker-trusted-registry/configuration/" class=""> Configuration options</a>
                      
                      
                    
                      
                        <a data-link href="/docker-trusted-registry/support/" class=""> Support</a>
                      
                      
                    
                      
                        <a data-link href="/docker-trusted-registry/release-notes/" class=""> Release notes</a>
                      
                      
                    
                      
                        <a data-link href="/docker-trusted-registry/prior-release-notes/" class=""> Prior release notes archive</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Docker Registry</button>
                  <div data-content>
                    
                      
                        <a data-link href="/registry/" class=""> Docker Registry 2.0</a>
                      
                      
                    
                      
                        <a data-link href="/registry/introduction/" class=""> Understanding the Registry</a>
                      
                      
                    
                      
                        <a data-link href="/registry/deploying/" class=""> Deploying a registry server</a>
                      
                      
                    
                      
                        <a data-link href="/registry/configuration/" class=""> Configure a Registry</a>
                      
                      
                    
                      
                        <a data-link href="/registry/notifications/" class=""> Work with Notifications</a>
                      
                      
                    
                      
                        <a data-link href="/registry/authentication/" class=""> Authentication for the Registry</a>
                      
                      
                    
                      
                        <a data-link href="/registry/help/" class=""> Getting help</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <a data-link href="/articles/certificates/" class=""> Using certificates for repository client verification</a>
              
            
              
                <a data-link href="/articles/registry_mirror/" class=""> Run a local registry mirror</a>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> Command and API references</button>
          <div data-content>
            
              
                <article data-accordion>
                  <button data-control> Command line reference</button>
                  <div data-content>
                    
                      
                        <a data-link href="/docker/reference/commandline/cli/" class=""> Using the command line</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/daemon/" class=""> daemon</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/attach/" class=""> attach</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/build/" class=""> build</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/commit/" class=""> commit</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/cp/" class=""> cp</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/create/" class=""> create</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/diff/" class=""> diff</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/events/" class=""> events</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/exec/" class=""> exec</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/export/" class=""> export</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/history/" class=""> history</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/images/" class=""> images</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/import/" class=""> import</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/info/" class=""> info</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/inspect/" class=""> inspect</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/kill/" class=""> kill</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/load/" class=""> load</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/login/" class=""> login</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/logout/" class=""> logout</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/logs/" class=""> logs</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/pause/" class=""> pause</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/port/" class=""> port</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/ps/" class=""> ps</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/pull/" class=""> pull</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/push/" class=""> push</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/rename/" class=""> rename</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/restart/" class=""> restart</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/rm/" class=""> rm</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/rmi/" class=""> rmi</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/run/" class=""> run</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/save/" class=""> save</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/search/" class=""> search</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/start/" class=""> start</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/stats/" class=""> stats</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/stop/" class=""> stop</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/tag/" class=""> tag</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/top/" class=""> top</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/unpause/" class=""> unpause</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/version/" class=""> version</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/commandline/wait/" class=""> wait</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <a data-link href="/docker/reference/run/" class=""> Docker run reference</a>
              
            
              
                <a data-link href="/docker/reference/builder/" class=""> Dockerfile reference</a>
              
            
              
                <a data-link href="/docker/reference/api/remote_api_client_libraries/" class=""> Remote API client libraries</a>
              
            
              
                <a data-link href="/docker/reference/api/docker_io_accounts_api/" class=""> docker.io accounts API</a>
              
            
              
                <article data-accordion>
                  <button data-control> Docker Remote API</button>
                  <div data-content>
                    
                      
                        <a data-link href="/docker/reference/api/docker-io_api/" class=""> Docker Hub API</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/api/docker_remote_api/" class=""> Remote API</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/api/docker_remote_api_v1.19/" class=""> Remote API v1.19</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/api/docker_remote_api_v1.18/" class=""> Remote API v1.18</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/api/docker_remote_api_v1.17/" class=""> Remote API v1.17</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/api/docker_remote_api_v1.16/" class=""> Remote API v1.16</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/api/docker_remote_api_v1.15/" class=""> Remote API v1.15</a>
                      
                      
                    
                      
                        <a data-link href="/docker/reference/api/docker_remote_api_v1.14/" class=""> Remote API v1.14</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Docker Hub</button>
                  <div data-content>
                    
                      
                        <a data-link href="/docker/reference/api/hub_registry_spec/" class=""> The Docker Hub and the Registry v1</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Docker Compose Reference</button>
                  <div data-content>
                    
                      
                        <a data-link href="/compose/cli/" class=""> Compose CLI reference</a>
                      
                      
                    
                      
                        <a data-link href="/compose/yml/" class=""> docker-compose.yml reference</a>
                      
                      
                    
                      
                        <a data-link href="/compose/env/" class=""> Compose environment variables reference</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <a data-link href="" class=""> Docker Machine Reference</a>
              
            
              
                <article data-accordion>
                  <button data-control> Docker Swarm Reference</button>
                  <div data-content>
                    
                      
                        <a data-link href="/swarm/api/swarm-api/" class=""> Docker Swarm API</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Docker Registry Reference</button>
                  <div data-content>
                    
                      
                        <a data-link href="/registry/spec/api/" class=""> Docker Registry HTTP API V2</a>
                      
                      
                    
                      
                        <a data-link href="/registry/storagedrivers/" class=""> Docker Registry Storage Driver</a>
                      
                      
                    
                      
                        <a data-link href="/registry/spec/auth/token/" class=""> Docker Registry v2 Authentication</a>
                      
                      
                    
                  </div>
                </article>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> Open Source at Docker</button>
          <div data-content>
            
              
                <a data-link href="/opensource/how-to-contribute/" class=""> Overview of contributing</a>
              
            
              
                <a data-link href="/docker/project/get-help/" class=""> Where to chat or get help</a>
              
            
              
                <article data-accordion>
                  <button data-control> Configure Development Environment</button>
                  <div data-content>
                    
                      
                        <a data-link href="/docker/project/who-written-for/" class=""> README first</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/software-required/" class=""> Get the required software</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/software-req-win/" class=""> Set up for development on Windows</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/set-up-git/" class=""> Configure Git for contributing</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/set-up-dev-env/" class=""> Work with a development container</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/test-and-docs/" class=""> Run tests and test documentation</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <article data-accordion>
                  <button data-control> Contribution Workflow</button>
                  <div data-content>
                    
                      
                        <a data-link href="/docker/project/make-a-contribution/" class=""> Understand how to contribute</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/find-an-issue/" class=""> Find and claim an issue</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/work-issue/" class=""> Work on your issue</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/create-pr/" class=""> Create a pull request (PR)</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/review-pr/" class=""> Participate in the PR review</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/advanced-contributing/" class=""> Advanced contributing</a>
                      
                      
                    
                      
                        <a data-link href="/docker/project/coding-style/" class=""> Coding style checklist</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <a data-link href="/opensource/code/" class=""> Contribute code overview</a>
              
            
              
                <a data-link href="/opensource/community/" class=""> Support the community</a>
              
            
              
                <a data-link href="/opensource/issues/" class=""> Organize our issues</a>
              
            
              
                <a data-link href="/opensource/meetups/" class=""> Organize a Docker Meetup</a>
              
            
              
                <a data-link href="/opensource/test/" class=""> Testing contributions</a>
              
            
              
                <article data-accordion>
                  <button data-control> Governance</button>
                  <div data-content>
                    
                      
                        <a data-link href="/opensource/governance/dgab-info/" class=""> Docker Governance Advisory Board</a>
                      
                      
                    
                      
                        <a data-link href="/opensource/governance/board-profiles/" class=""> Board member profiles</a>
                      
                      
                    
                      
                        <a data-link href="/opensource/governance/conduct-code/" class=""> Code of conduct</a>
                      
                      
                    
                  </div>
                </article>
              
            
              
                <a data-link href="/docker/project/doc-style/" class=""> Style guide for Docker documentation</a>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> About</button>
          <div data-content>
            
              
                <a data-link href="/release-notes/" class=""> Docker Release Notes</a>
              
            
              
                <a data-link href="/swarm/release-notes/" class=""> Docker Swarm Release Notes</a>
              
            
              
                <a data-link href="/docker/misc/faq/" class=""> FAQ</a>
              
            
              
                <a data-link href="/docker/reference/glossary/" class=""> Docker Glossary</a>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button style="visibility: hidden" data-control> Get older docs</button>
          <div data-content>
            
              
                <a data-link href="https://docs.docker.com/v1.6/" class=""> Version 1.6</a>
              
            
              
                <a data-link href="https://docs.docker.com/v1.5/" class=""> Version 1.5</a>
              
            
              
                <a data-link href="https://docs.docker.com/v1.4/" class=""> Version 1.4</a>
              
            
          </div>
        </article>
       
    </section>
  
</section>

<script>
$(document).ready(function () {
  var $activeLink = $('#multiple [data-link].active');
  var $accordions = $activeLink.parents('article[data-accordion]');
  $($accordions.get().reverse()).each(function (index, accordion) {
    var $accordion = $(accordion);
    var $content = $accordion.find('[data-content]');
    $accordion.addClass('open');
    $content.css({'max-height': '100%'});
  });
});
</script>
    </div>
    <div class="large-6 columns">
      <section id="main">
        <article id="content">
          

<h1 id="network-configuration">Network configuration</h1>

<h2 id="summary">Summary</h2>

<p>When Docker starts, it creates a virtual interface named <code>docker0</code> on
the host machine.  It randomly chooses an address and subnet from the
private range defined by <a href="http://tools.ietf.org/html/rfc1918">RFC 1918</a>
that are not in use on the host machine, and assigns it to <code>docker0</code>.
Docker made the choice <code>172.17.42.1/16</code> when I started it a few minutes
ago, for example — a 16-bit netmask providing 65,534 addresses for the
host machine and its containers. The MAC address is generated using the
IP address allocated to the container to avoid ARP collisions, using a
range from <code>02:42:ac:11:00:00</code> to <code>02:42:ac:11:ff:ff</code>.</p>

<blockquote>
<p><strong>Note:</strong>
This document discusses advanced networking configuration
and options for Docker. In most cases you won&rsquo;t need this information.
If you&rsquo;re looking to get started with a simpler explanation of Docker
networking and an introduction to the concept of container linking see
the <a href="/userguide/dockerlinks/">Docker User Guide</a>.</p>
</blockquote>

<p>But <code>docker0</code> is no ordinary interface.  It is a virtual <em>Ethernet
bridge</em> that automatically forwards packets between any other network
interfaces that are attached to it.  This lets containers communicate
both with the host machine and with each other.  Every time Docker
creates a container, it creates a pair of “peer” interfaces that are
like opposite ends of a pipe — a packet sent on one will be received on
the other.  It gives one of the peers to the container to become its
<code>eth0</code> interface and keeps the other peer, with a unique name like
<code>vethAQI2QT</code>, out in the namespace of the host machine.  By binding
every <code>veth*</code> interface to the <code>docker0</code> bridge, Docker creates a
virtual subnet shared between the host machine and every Docker
container.</p>

<p>The remaining sections of this document explain all of the ways that you
can use Docker options and — in advanced cases — raw Linux networking
commands to tweak, supplement, or entirely replace Docker&rsquo;s default
networking configuration.</p>

<h2 id="quick-guide-to-the-options">Quick guide to the options</h2>

<p>Here is a quick list of the networking-related Docker command-line
options, in case it helps you find the section below that you are
looking for.</p>

<p>Some networking command-line options can only be supplied to the Docker
server when it starts up, and cannot be changed once it is running:</p>

<ul>
<li><p><code>-b BRIDGE</code> or <code>--bridge=BRIDGE</code> — see
<a href="#bridge-building">Building your own bridge</a></p></li>

<li><p><code>--bip=CIDR</code> — see
<a href="#docker0">Customizing docker0</a></p></li>

<li><p><code>--default-gateway=IP_ADDRESS</code> — see
<a href="#container-networking">How Docker networks a container</a></p></li>

<li><p><code>--default-gateway-v6=IP_ADDRESS</code> — see
<a href="#ipv6">IPv6</a></p></li>

<li><p><code>--fixed-cidr</code> — see
<a href="#docker0">Customizing docker0</a></p></li>

<li><p><code>--fixed-cidr-v6</code> — see
<a href="#ipv6">IPv6</a></p></li>

<li><p><code>-H SOCKET...</code> or <code>--host=SOCKET...</code> —
This might sound like it would affect container networking,
but it actually faces in the other direction:
it tells the Docker server over what channels
it should be willing to receive commands
like “run container” and “stop container.”</p></li>

<li><p><code>--icc=true|false</code> — see
<a href="#between-containers">Communication between containers</a></p></li>

<li><p><code>--ip=IP_ADDRESS</code> — see
<a href="#binding-ports">Binding container ports</a></p></li>

<li><p><code>--ipv6=true|false</code> — see
<a href="#ipv6">IPv6</a></p></li>

<li><p><code>--ip-forward=true|false</code> — see
<a href="#the-world">Communication between containers and the wider world</a></p></li>

<li><p><code>--iptables=true|false</code> — see
<a href="#between-containers">Communication between containers</a></p></li>

<li><p><code>--mtu=BYTES</code> — see
<a href="#docker0">Customizing docker0</a></p></li>

<li><p><code>--userland-proxy=true|false</code> — see
<a href="#binding-ports">Binding container ports</a></p></li>
</ul>

<p>There are two networking options that can be supplied either at startup
or when <code>docker run</code> is invoked.  When provided at startup, set the
default value that <code>docker run</code> will later use if the options are not
specified:</p>

<ul>
<li><p><code>--dns=IP_ADDRESS...</code> — see
<a href="#dns">Configuring DNS</a></p></li>

<li><p><code>--dns-search=DOMAIN...</code> — see
<a href="#dns">Configuring DNS</a></p></li>
</ul>

<p>Finally, several networking options can only be provided when calling
<code>docker run</code> because they specify something specific to one container:</p>

<ul>
<li><p><code>-h HOSTNAME</code> or <code>--hostname=HOSTNAME</code> — see
<a href="#dns">Configuring DNS</a> and
<a href="#container-networking">How Docker networks a container</a></p></li>

<li><p><code>--link=CONTAINER_NAME_or_ID:ALIAS</code> — see
<a href="#dns">Configuring DNS</a> and
<a href="#between-containers">Communication between containers</a></p></li>

<li><p><code>--net=bridge|none|container:NAME_or_ID|host</code> — see
<a href="#container-networking">How Docker networks a container</a></p></li>

<li><p><code>--mac-address=MACADDRESS...</code> — see
<a href="#container-networking">How Docker networks a container</a></p></li>

<li><p><code>-p SPEC</code> or <code>--publish=SPEC</code> — see
<a href="#binding-ports">Binding container ports</a></p></li>

<li><p><code>-P</code> or <code>--publish-all=true|false</code> — see
<a href="#binding-ports">Binding container ports</a></p></li>
</ul>

<p>To supply networking options to the Docker server at startup, use the
<code>DOCKER_OPTS</code> variable in the Docker upstart configuration file. For Ubuntu, edit the
variable in <code>/etc/default/docker</code> or <code>/etc/sysconfig/docker</code> for CentOS.</p>

<p>The following example illustrates how to configure Docker on Ubuntu to recognize a
newly built bridge.</p>

<p>Edit the <code>/etc/default/docker</code> file:</p>

<pre><code>$ echo 'DOCKER_OPTS=&quot;-b=bridge0&quot;' &gt;&gt; /etc/default/docker 
</code></pre>

<p>Then restart the Docker server.</p>

<pre><code>$ sudo service docker start
</code></pre>

<p>For additional information on bridges, see <a href="#building-your-own-bridge">building your own
bridge</a> later on this page.</p>

<p>The following sections tackle all of the above topics in an order that we can move roughly from simplest to most complex.</p>

<h2 id="configuring-dns">Configuring DNS</h2>

<p><a name="dns"></a></p>

<p>How can Docker supply each container with a hostname and DNS
configuration, without having to build a custom image with the hostname
written inside?  Its trick is to overlay three crucial <code>/etc</code> files
inside the container with virtual files where it can write fresh
information.  You can see this by running <code>mount</code> inside a container:</p>

<pre><code>$$ mount
...
/dev/disk/by-uuid/1fec...ebdf on /etc/hostname type ext4 ...
/dev/disk/by-uuid/1fec...ebdf on /etc/hosts type ext4 ...
/dev/disk/by-uuid/1fec...ebdf on /etc/resolv.conf type ext4 ...
...
</code></pre>

<p>This arrangement allows Docker to do clever things like keep
<code>resolv.conf</code> up to date across all containers when the host machine
receives new configuration over DHCP later.  The exact details of how
Docker maintains these files inside the container can change from one
Docker version to the next, so you should leave the files themselves
alone and use the following Docker options instead.</p>

<p>Four different options affect container domain name services.</p>

<ul>
<li><p><code>-h HOSTNAME</code> or <code>--hostname=HOSTNAME</code> — sets the hostname by which
the container knows itself.  This is written into <code>/etc/hostname</code>,
into <code>/etc/hosts</code> as the name of the container&rsquo;s host-facing IP
address, and is the name that <code>/bin/bash</code> inside the container will
display inside its prompt.  But the hostname is not easy to see from
outside the container.  It will not appear in <code>docker ps</code> nor in the
<code>/etc/hosts</code> file of any other container.</p></li>

<li><p><code>--link=CONTAINER_NAME_or_ID:ALIAS</code> — using this option as you <code>run</code> a
container gives the new container&rsquo;s <code>/etc/hosts</code> an extra entry
named <code>ALIAS</code> that points to the IP address of the container identified by
<code>CONTAINER_NAME_or_ID</code>.  This lets processes inside the new container
connect to the hostname <code>ALIAS</code> without having to know its IP.  The
<code>--link=</code> option is discussed in more detail below, in the section
<a href="#between-containers">Communication between containers</a>. Because
Docker may assign a different IP address to the linked containers
on restart, Docker updates the <code>ALIAS</code> entry in the <code>/etc/hosts</code> file
of the recipient containers.</p></li>

<li><p><code>--dns=IP_ADDRESS...</code> — sets the IP addresses added as <code>server</code>
lines to the container&rsquo;s <code>/etc/resolv.conf</code> file.  Processes in the
container, when confronted with a hostname not in <code>/etc/hosts</code>, will
connect to these IP addresses on port 53 looking for name resolution
services.</p></li>

<li><p><code>--dns-search=DOMAIN...</code> — sets the domain names that are searched
when a bare unqualified hostname is used inside of the container, by
writing <code>search</code> lines into the container&rsquo;s <code>/etc/resolv.conf</code>.
When a container process attempts to access <code>host</code> and the search
domain <code>example.com</code> is set, for instance, the DNS logic will not
only look up <code>host</code> but also <code>host.example.com</code>.
Use <code>--dns-search=.</code> if you don&rsquo;t wish to set the search domain.</p></li>
</ul>

<p>Regarding DNS settings, in the absence of either the <code>--dns=IP_ADDRESS...</code>
or the <code>--dns-search=DOMAIN...</code> option, Docker makes each container&rsquo;s
<code>/etc/resolv.conf</code> look like the <code>/etc/resolv.conf</code> of the host machine (where
the <code>docker</code> daemon runs).  When creating the container&rsquo;s <code>/etc/resolv.conf</code>,
the daemon filters out all localhost IP address <code>nameserver</code> entries from
the host&rsquo;s original file.</p>

<p>Filtering is necessary because all localhost addresses on the host are
unreachable from the container&rsquo;s network.  After this filtering, if there
are no more <code>nameserver</code> entries left in the container&rsquo;s <code>/etc/resolv.conf</code>
file, the daemon adds public Google DNS nameservers
(8.8.8.8 and 8.8.4.4) to the container&rsquo;s DNS configuration.  If IPv6 is
enabled on the daemon, the public IPv6 Google DNS nameservers will also
be added (2001:4860:4860::8888 and 2001:4860:4860::8844).</p>

<blockquote>
<p><strong>Note</strong>:
If you need access to a host&rsquo;s localhost resolver, you must modify your
DNS service on the host to listen on a non-localhost address that is
reachable from within the container.</p>
</blockquote>

<p>You might wonder what happens when the host machine&rsquo;s
<code>/etc/resolv.conf</code> file changes.  The <code>docker</code> daemon has a file change
notifier active which will watch for changes to the host DNS configuration.</p>

<blockquote>
<p><strong>Note</strong>:
The file change notifier relies on the Linux kernel&rsquo;s inotify feature.
Because this feature is currently incompatible with the overlay filesystem
driver, a Docker daemon using &ldquo;overlay&rdquo; will not be able to take advantage
of the <code>/etc/resolv.conf</code> auto-update feature.</p>
</blockquote>

<p>When the host file changes, all stopped containers which have a matching
<code>resolv.conf</code> to the host will be updated immediately to this newest host
configuration.  Containers which are running when the host configuration
changes will need to stop and start to pick up the host changes due to lack
of a facility to ensure atomic writes of the <code>resolv.conf</code> file while the
container is running. If the container&rsquo;s <code>resolv.conf</code> has been edited since
it was started with the default configuration, no replacement will be
attempted as it would overwrite the changes performed by the container.
If the options (<code>--dns</code> or <code>--dns-search</code>) have been used to modify the
default host configuration, then the replacement with an updated host&rsquo;s
<code>/etc/resolv.conf</code> will not happen as well.</p>

<blockquote>
<p><strong>Note</strong>:
For containers which were created prior to the implementation of
the <code>/etc/resolv.conf</code> update feature in Docker 1.5.0: those
containers will <strong>not</strong> receive updates when the host <code>resolv.conf</code>
file changes. Only containers created with Docker 1.5.0 and above
will utilize this auto-update feature.</p>
</blockquote>

<h2 id="communication-between-containers-and-the-wider-world">Communication between containers and the wider world</h2>

<p><a name="the-world"></a></p>

<p>Whether a container can talk to the world is governed by two factors.</p>

<ol>
<li><p>Is the host machine willing to forward IP packets?  This is governed
by the <code>ip_forward</code> system parameter.  Packets can only pass between
containers if this parameter is <code>1</code>.  Usually you will simply leave
the Docker server at its default setting <code>--ip-forward=true</code> and
Docker will go set <code>ip_forward</code> to <code>1</code> for you when the server
starts up. To check the setting or turn it on manually:</p>

<pre><code>$ sysctl net.ipv4.conf.all.forwarding
net.ipv4.conf.all.forwarding = 0
$ sysctl net.ipv4.conf.all.forwarding=1
$ sysctl net.ipv4.conf.all.forwarding
net.ipv4.conf.all.forwarding = 1
</code></pre>

<p>Many using Docker will want <code>ip_forward</code> to be on, to at
least make communication <em>possible</em> between containers and
the wider world.</p>

<p>May also be needed for inter-container communication if you are
in a multiple bridge setup.</p></li>

<li><p>Do your <code>iptables</code> allow this particular connection? Docker will
never make changes to your system <code>iptables</code> rules if you set
<code>--iptables=false</code> when the daemon starts.  Otherwise the Docker
server will append forwarding rules to the <code>DOCKER</code> filter chain.</p></li>
</ol>

<p>Docker will not delete or modify any pre-existing rules from the <code>DOCKER</code>
filter chain. This allows the user to create in advance any rules required
to further restrict access to the containers.</p>

<p>Docker&rsquo;s forward rules permit all external source IPs by default. To allow
only a specific IP or network to access the containers, insert a negated
rule at the top of the <code>DOCKER</code> filter chain. For example, to restrict
external access such that <em>only</em> source IP 8.8.8.8 can access the
containers, the following rule could be added:</p>

<pre><code>$ iptables -I DOCKER -i ext_if ! -s 8.8.8.8 -j DROP
</code></pre>

<h2 id="communication-between-containers">Communication between containers</h2>

<p><a name="between-containers"></a></p>

<p>Whether two containers can communicate is governed, at the operating
system level, by two factors.</p>

<ol>
<li><p>Does the network topology even connect the containers&rsquo; network
interfaces?  By default Docker will attach all containers to a
single <code>docker0</code> bridge, providing a path for packets to travel
between them.  See the later sections of this document for other
possible topologies.</p></li>

<li><p>Do your <code>iptables</code> allow this particular connection? Docker will never
make changes to your system <code>iptables</code> rules if you set
<code>--iptables=false</code> when the daemon starts.  Otherwise the Docker server
will add a default rule to the <code>FORWARD</code> chain with a blanket <code>ACCEPT</code>
policy if you retain the default <code>--icc=true</code>, or else will set the
policy to <code>DROP</code> if <code>--icc=false</code>.</p></li>
</ol>

<p>It is a strategic question whether to leave <code>--icc=true</code> or change it to
<code>--icc=false</code> so that
<code>iptables</code> will protect other containers — and the main host — from
having arbitrary ports probed or accessed by a container that gets
compromised.</p>

<p>If you choose the most secure setting of <code>--icc=false</code>, then how can
containers communicate in those cases where you <em>want</em> them to provide
each other services?</p>

<p>The answer is the <code>--link=CONTAINER_NAME_or_ID:ALIAS</code> option, which was
mentioned in the previous section because of its effect upon name
services.  If the Docker daemon is running with both <code>--icc=false</code> and
<code>--iptables=true</code> then, when it sees <code>docker run</code> invoked with the
<code>--link=</code> option, the Docker server will insert a pair of <code>iptables</code>
<code>ACCEPT</code> rules so that the new container can connect to the ports
exposed by the other container — the ports that it mentioned in the
<code>EXPOSE</code> lines of its <code>Dockerfile</code>.  Docker has more documentation on
this subject — see the <a href="/userguide/dockerlinks">linking Docker containers</a>
page for further details.</p>

<blockquote>
<p><strong>Note</strong>:
The value <code>CONTAINER_NAME</code> in <code>--link=</code> must either be an
auto-assigned Docker name like <code>stupefied_pare</code> or else the name you
assigned with <code>--name=</code> when you ran <code>docker run</code>.  It cannot be a
hostname, which Docker will not recognize in the context of the
<code>--link=</code> option.</p>
</blockquote>

<p>You can run the <code>iptables</code> command on your Docker host to see whether
the <code>FORWARD</code> chain has a default policy of <code>ACCEPT</code> or <code>DROP</code>:</p>

<pre><code># When --icc=false, you should see a DROP rule:

$ sudo iptables -L -n
...
Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
DOCKER     all  --  0.0.0.0/0            0.0.0.0/0
DROP       all  --  0.0.0.0/0            0.0.0.0/0
...

# When a --link= has been created under --icc=false,
# you should see port-specific ACCEPT rules overriding
# the subsequent DROP policy for all other packets:

$ sudo iptables -L -n
...
Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
DOCKER     all  --  0.0.0.0/0            0.0.0.0/0
DROP       all  --  0.0.0.0/0            0.0.0.0/0

Chain DOCKER (1 references)
target     prot opt source               destination
ACCEPT     tcp  --  172.17.0.2           172.17.0.3           tcp spt:80
ACCEPT     tcp  --  172.17.0.3           172.17.0.2           tcp dpt:80
</code></pre>

<blockquote>
<p><strong>Note</strong>:
Docker is careful that its host-wide <code>iptables</code> rules fully expose
containers to each other&rsquo;s raw IP addresses, so connections from one
container to another should always appear to be originating from the
first container&rsquo;s own IP address.</p>
</blockquote>

<h2 id="binding-container-ports-to-the-host">Binding container ports to the host</h2>

<p><a name="binding-ports"></a></p>

<p>By default Docker containers can make connections to the outside world,
but the outside world cannot connect to containers.  Each outgoing
connection will appear to originate from one of the host machine&rsquo;s own
IP addresses thanks to an <code>iptables</code> masquerading rule on the host
machine that the Docker server creates when it starts:</p>

<pre><code># You can see that the Docker server creates a
# masquerade rule that let containers connect
# to IP addresses in the outside world:

$ sudo iptables -t nat -L -n
...
Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination
MASQUERADE  all  --  172.17.0.0/16       0.0.0.0/0
...
</code></pre>

<p>But if you want containers to accept incoming connections, you will need
to provide special options when invoking <code>docker run</code>.  These options
are covered in more detail in the <a href="/userguide/dockerlinks">Docker User Guide</a>
page.  There are two approaches.</p>

<p>First, you can supply <code>-P</code> or <code>--publish-all=true|false</code> to <code>docker run</code> which
is a blanket operation that identifies every port with an <code>EXPOSE</code> line in the
image&rsquo;s <code>Dockerfile</code> or <code>--expose &lt;port&gt;</code> commandline flag and maps it to a
host port somewhere within an <em>ephemeral port range</em>. The <code>docker port</code> command
then needs to be used to inspect created mapping. The <em>ephemeral port range</em> is
configured by <code>/proc/sys/net/ipv4/ip_local_port_range</code> kernel parameter,
typically ranging from 32768 to 61000.</p>

<p>Mapping can be specified explicitly using <code>-p SPEC</code> or <code>--publish=SPEC</code> option.
It allows you to particularize which port on docker server - which can be any
port at all, not just one within the <em>ephemeral port range</em> — you want mapped
to which port in the container.</p>

<p>Either way, you should be able to peek at what Docker has accomplished
in your network stack by examining your NAT tables.</p>

<pre><code># What your NAT rules might look like when Docker
# is finished setting up a -P forward:

$ iptables -t nat -L -n
...
Chain DOCKER (2 references)
target     prot opt source               destination
DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:49153 to:172.17.0.2:80

# What your NAT rules might look like when Docker
# is finished setting up a -p 80:80 forward:

Chain DOCKER (2 references)
target     prot opt source               destination
DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:172.17.0.2:80
</code></pre>

<p>You can see that Docker has exposed these container ports on <code>0.0.0.0</code>,
the wildcard IP address that will match any possible incoming port on
the host machine.  If you want to be more restrictive and only allow
container services to be contacted through a specific external interface
on the host machine, you have two choices.  When you invoke <code>docker run</code>
you can use either <code>-p IP:host_port:container_port</code> or <code>-p IP::port</code> to
specify the external interface for one particular binding.</p>

<p>Or if you always want Docker port forwards to bind to one specific IP
address, you can edit your system-wide Docker server settings and add the
option <code>--ip=IP_ADDRESS</code>.  Remember to restart your Docker server after
editing this setting.</p>

<blockquote>
<p><strong>Note</strong>:
With hairpin NAT enabled (<code>--userland-proxy=false</code>), containers port exposure
is achieved purely through iptables rules, and no attempt to bind the exposed
port is ever made. This means that nothing prevents shadowing a previously
listening service outside of Docker through exposing the same port for a
container. In such conflicting situation, Docker created iptables rules will
take precedence and route to the container.</p>
</blockquote>

<p>The <code>--userland-proxy</code> parameter, true by default, provides a userland
implementation for inter-container and outside-to-container communication. When
disabled, Docker uses both an additional <code>MASQUERADE</code> iptable rule and the
<code>net.ipv4.route_localnet</code> kernel parameter which allow the host machine to
connect to a local container exposed port through the commonly used loopback
address: this alternative is preferred for performance reason.</p>

<p>Again, this topic is covered without all of these low-level networking
details in the <a href="/userguide/dockerlinks/">Docker User Guide</a> document if you
would like to use that as your port redirection reference instead.</p>

<h2 id="ipv6">IPv6</h2>

<p><a name="ipv6"></a></p>

<p>As we are <a href="http://en.wikipedia.org/wiki/IPv4_address_exhaustion">running out of IPv4 addresses</a>
the IETF has standardized an IPv4 successor, <a href="http://en.wikipedia.org/wiki/IPv6">Internet Protocol Version 6</a>
, in <a href="https://www.ietf.org/rfc/rfc2460.txt">RFC 2460</a>. Both protocols, IPv4 and
IPv6, reside on layer 3 of the <a href="http://en.wikipedia.org/wiki/OSI_model">OSI model</a>.</p>

<h3 id="ipv6-with-docker">IPv6 with Docker</h3>

<p>By default, the Docker server configures the container network for IPv4 only.
You can enable IPv4/IPv6 dualstack support by running the Docker daemon with the
<code>--ipv6</code> flag. Docker will set up the bridge <code>docker0</code> with the IPv6
<a href="http://en.wikipedia.org/wiki/Link-local_address">link-local address</a> <code>fe80::1</code>.</p>

<p>By default, containers that are created will only get a link-local IPv6 address.
To assign globally routable IPv6 addresses to your containers you have to
specify an IPv6 subnet to pick the addresses from. Set the IPv6 subnet via the
<code>--fixed-cidr-v6</code> parameter when starting Docker daemon:</p>

<pre><code>docker -d --ipv6 --fixed-cidr-v6=&quot;2001:db8:1::/64&quot;
</code></pre>

<p>The subnet for Docker containers should at least have a size of <code>/80</code>. This way
an IPv6 address can end with the container&rsquo;s MAC address and you prevent NDP
neighbor cache invalidation issues in the Docker layer.</p>

<p>With the <code>--fixed-cidr-v6</code> parameter set Docker will add a new route to the
routing table. Further IPv6 routing will be enabled (you may prevent this by
starting Docker daemon with <code>--ip-forward=false</code>):</p>

<pre><code>$ ip -6 route add 2001:db8:1::/64 dev docker0
$ sysctl net.ipv6.conf.default.forwarding=1
$ sysctl net.ipv6.conf.all.forwarding=1
</code></pre>

<p>All traffic to the subnet <code>2001:db8:1::/64</code> will now be routed
via the <code>docker0</code> interface.</p>

<p>Be aware that IPv6 forwarding may interfere with your existing IPv6
configuration: If you are using Router Advertisements to get IPv6 settings for
your host&rsquo;s interfaces you should set <code>accept_ra</code> to <code>2</code>. Otherwise IPv6
enabled forwarding will result in rejecting Router Advertisements. E.g., if you
want to configure <code>eth0</code> via Router Advertisements you should set:</p>

<pre><code>$ sysctl net.ipv6.conf.eth0.accept_ra=2
</code></pre>

<p><img src="/article-img/ipv6_basic_host_config.svg" alt="" />
</p>

<p>Every new container will get an IPv6 address from the defined subnet. Further
a default route will be added on <code>eth0</code> in the container via the address
specified by the daemon option <code>--default-gateway-v6</code> if present, otherwise
via <code>fe80::1</code>:</p>

<pre><code>docker run -it ubuntu bash -c &quot;ip -6 addr show dev eth0; ip -6 route show&quot;

15: eth0: &lt;BROADCAST,UP,LOWER_UP&gt; mtu 1500
   inet6 2001:db8:1:0:0:242:ac11:3/64 scope global
      valid_lft forever preferred_lft forever
   inet6 fe80::42:acff:fe11:3/64 scope link
      valid_lft forever preferred_lft forever

2001:db8:1::/64 dev eth0  proto kernel  metric 256
fe80::/64 dev eth0  proto kernel  metric 256
default via fe80::1 dev eth0  metric 1024
</code></pre>

<p>In this example the Docker container is assigned a link-local address with the
network suffix <code>/64</code> (here: <code>fe80::42:acff:fe11:3/64</code>) and a globally routable
IPv6 address (here: <code>2001:db8:1:0:0:242:ac11:3/64</code>). The container will create
connections to addresses outside of the <code>2001:db8:1::/64</code> network via the
link-local gateway at <code>fe80::1</code> on <code>eth0</code>.</p>

<p>Often servers or virtual machines get a <code>/64</code> IPv6 subnet assigned (e.g.
<code>2001:db8:23:42::/64</code>). In this case you can split it up further and provide
Docker a <code>/80</code> subnet while using a separate <code>/80</code> subnet for other
applications on the host:</p>

<p><img src="/article-img/ipv6_slash64_subnet_config.svg" alt="" />
</p>

<p>In this setup the subnet <code>2001:db8:23:42::/80</code> with a range from <code>2001:db8:23:42:0:0:0:0</code>
to <code>2001:db8:23:42:0:ffff:ffff:ffff</code> is attached to <code>eth0</code>, with the host listening
at <code>2001:db8:23:42::1</code>. The subnet <code>2001:db8:23:42:1::/80</code> with an address range from
<code>2001:db8:23:42:1:0:0:0</code> to <code>2001:db8:23:42:1:ffff:ffff:ffff</code> is attached to
<code>docker0</code> and will be used by containers.</p>

<h4 id="using-ndp-proxying">Using NDP proxying</h4>

<p>If your Docker host is only part of an IPv6 subnet but has not got an IPv6
subnet assigned you can use NDP proxying to connect your containers via IPv6 to
the internet.
For example your host has the IPv6 address <code>2001:db8::c001</code>, is part of the
subnet <code>2001:db8::/64</code> and your IaaS provider allows you to configure the IPv6
addresses <code>2001:db8::c000</code> to <code>2001:db8::c00f</code>:</p>

<pre><code>$ ip -6 addr show
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qlen 1000
    inet6 2001:db8::c001/64 scope global
       valid_lft forever preferred_lft forever
    inet6 fe80::601:3fff:fea1:9c01/64 scope link
       valid_lft forever preferred_lft forever
</code></pre>

<p>Let&rsquo;s split up the configurable address range into two subnets
<code>2001:db8::c000/125</code> and <code>2001:db8::c008/125</code>. The first one can be used by the
host itself, the latter by Docker:</p>

<pre><code>docker -d --ipv6 --fixed-cidr-v6 2001:db8::c008/125
</code></pre>

<p>You notice the Docker subnet is within the subnet managed by your router that
is connected to <code>eth0</code>. This means all devices (containers) with the addresses
from the Docker subnet are expected to be found within the router subnet.
Therefore the router thinks it can talk to these containers directly.</p>

<p><img src="/article-img/ipv6_ndp_proxying.svg" alt="" />
</p>

<p>As soon as the router wants to send an IPv6 packet to the first container it
will transmit a neighbor solicitation request, asking, who has
<code>2001:db8::c009</code>? But it will get no answer because no one on this subnet has
this address. The container with this address is hidden behind the Docker host.
The Docker host has to listen to neighbor solicitation requests for the container
address and send a response that itself is the device that is responsible for
the address. This is done by a Kernel feature called <code>NDP Proxy</code>. You can
enable it by executing</p>

<pre><code>$ sysctl net.ipv6.conf.eth0.proxy_ndp=1
</code></pre>

<p>Now you can add the container&rsquo;s IPv6 address to the NDP proxy table:</p>

<pre><code>$ ip -6 neigh add proxy 2001:db8::c009 dev eth0
</code></pre>

<p>This command tells the Kernel to answer to incoming neighbor solicitation requests
regarding the IPv6 address <code>2001:db8::c009</code> on the device <code>eth0</code>. As a
consequence of this all traffic to this IPv6 address will go into the Docker
host and it will forward it according to its routing table via the <code>docker0</code>
device to the container network:</p>

<pre><code>$ ip -6 route show
2001:db8::c008/125 dev docker0  metric 1
2001:db8::/64 dev eth0  proto kernel  metric 256
</code></pre>

<p>You have to execute the <code>ip -6 neigh add proxy ...</code> command for every IPv6
address in your Docker subnet. Unfortunately there is no functionality for
adding a whole subnet by executing one command.</p>

<h3 id="docker-ipv6-cluster">Docker IPv6 cluster</h3>

<h4 id="switched-network-environment">Switched network environment</h4>

<p>Using routable IPv6 addresses allows you to realize communication between
containers on different hosts. Let&rsquo;s have a look at a simple Docker IPv6 cluster
example:</p>

<p><img src="/article-img/ipv6_switched_network_example.svg" alt="" />
</p>

<p>The Docker hosts are in the <code>2001:db8:0::/64</code> subnet. Host1 is configured
to provide addresses from the <code>2001:db8:1::/64</code> subnet to its containers. It
has three routes configured:</p>

<ul>
<li>Route all traffic to <code>2001:db8:0::/64</code> via <code>eth0</code></li>
<li>Route all traffic to <code>2001:db8:1::/64</code> via <code>docker0</code></li>
<li>Route all traffic to <code>2001:db8:2::/64</code> via Host2 with IP <code>2001:db8::2</code></li>
</ul>

<p>Host1 also acts as a router on OSI layer 3. When one of the network clients
tries to contact a target that is specified in Host1&rsquo;s routing table Host1 will
forward the traffic accordingly. It acts as a router for all networks it knows:
<code>2001:db8::/64</code>, <code>2001:db8:1::/64</code> and <code>2001:db8:2::/64</code>.</p>

<p>On Host2 we have nearly the same configuration. Host2&rsquo;s containers will get
IPv6 addresses from <code>2001:db8:2::/64</code>. Host2 has three routes configured:</p>

<ul>
<li>Route all traffic to <code>2001:db8:0::/64</code> via <code>eth0</code></li>
<li>Route all traffic to <code>2001:db8:2::/64</code> via <code>docker0</code></li>
<li>Route all traffic to <code>2001:db8:1::/64</code> via Host1 with IP <code>2001:db8:0::1</code></li>
</ul>

<p>The difference to Host1 is that the network <code>2001:db8:2::/64</code> is directly
attached to the host via its <code>docker0</code> interface whereas it reaches
<code>2001:db8:1::/64</code> via Host1&rsquo;s IPv6 address <code>2001:db8::1</code>.</p>

<p>This way every container is able to contact every other container. The
containers <code>Container1-*</code> share the same subnet and contact each other directly.
The traffic between <code>Container1-*</code> and <code>Container2-*</code> will be routed via Host1
and Host2 because those containers do not share the same subnet.</p>

<p>In a switched environment every host has to know all routes to every subnet. You
always have to update the hosts&rsquo; routing tables once you add or remove a host
to the cluster.</p>

<p>Every configuration in the diagram that is shown below the dashed line is
handled by Docker: The <code>docker0</code> bridge IP address configuration, the route to
the Docker subnet on the host, the container IP addresses and the routes on the
containers. The configuration above the line is up to the user and can be
adapted to the individual environment.</p>

<h4 id="routed-network-environment">Routed network environment</h4>

<p>In a routed network environment you replace the layer 2 switch with a layer 3
router. Now the hosts just have to know their default gateway (the router) and
the route to their own containers (managed by Docker). The router holds all
routing information about the Docker subnets. When you add or remove a host to
this environment you just have to update the routing table in the router - not
on every host.</p>

<p><img src="/article-img/ipv6_routed_network_example.svg" alt="" />
</p>

<p>In this scenario containers of the same host can communicate directly with each
other. The traffic between containers on different hosts will be routed via
their hosts and the router. For example packet from <code>Container1-1</code> to
<code>Container2-1</code> will be routed through <code>Host1</code>, <code>Router</code> and <code>Host2</code> until it
arrives at <code>Container2-1</code>.</p>

<p>To keep the IPv6 addresses short in this example a <code>/48</code> network is assigned to
every host. The hosts use a <code>/64</code> subnet of this for its own services and one
for Docker. When adding a third host you would add a route for the subnet
<code>2001:db8:3::/48</code> in the router and configure Docker on Host3 with
<code>--fixed-cidr-v6=2001:db8:3:1::/64</code>.</p>

<p>Remember the subnet for Docker containers should at least have a size of <code>/80</code>.
This way an IPv6 address can end with the container&rsquo;s MAC address and you
prevent NDP neighbor cache invalidation issues in the Docker layer. So if you
have a <code>/64</code> for your whole environment use <code>/78</code> subnets for the hosts and
<code>/80</code> for the containers. This way you can use 4096 hosts with 16 <code>/80</code> subnets
each.</p>

<p>Every configuration in the diagram that is visualized below the dashed line is
handled by Docker: The <code>docker0</code> bridge IP address configuration, the route to
the Docker subnet on the host, the container IP addresses and the routes on the
containers. The configuration above the line is up to the user and can be
adapted to the individual environment.</p>

<h2 id="customizing-docker0">Customizing docker0</h2>

<p><a name="docker0"></a></p>

<p>By default, the Docker server creates and configures the host system&rsquo;s
<code>docker0</code> interface as an <em>Ethernet bridge</em> inside the Linux kernel that
can pass packets back and forth between other physical or virtual
network interfaces so that they behave as a single Ethernet network.</p>

<p>Docker configures <code>docker0</code> with an IP address, netmask and IP
allocation range. The host machine can both receive and send packets to
containers connected to the bridge, and gives it an MTU — the <em>maximum
transmission unit</em> or largest packet length that the interface will
allow — of either 1,500 bytes or else a more specific value copied from
the Docker host&rsquo;s interface that supports its default route.  These
options are configurable at server startup:</p>

<ul>
<li><p><code>--bip=CIDR</code> — supply a specific IP address and netmask for the
<code>docker0</code> bridge, using standard CIDR notation like
<code>192.168.1.5/24</code>.</p></li>

<li><p><code>--fixed-cidr=CIDR</code> — restrict the IP range from the <code>docker0</code> subnet,
using the standard CIDR notation like <code>172.167.1.0/28</code>. This range must
be and IPv4 range for fixed IPs (ex: 10.20.0.0/16) and must be a subset
of the bridge IP range (<code>docker0</code> or set using <code>--bridge</code>). For example
with <code>--fixed-cidr=192.168.1.0/25</code>, IPs for your containers will be chosen
from the first half of <code>192.168.1.0/24</code> subnet.</p></li>

<li><p><code>--mtu=BYTES</code> — override the maximum packet length on <code>docker0</code>.</p></li>
</ul>

<p>Once you have one or more containers up and running, you can confirm
that Docker has properly connected them to the <code>docker0</code> bridge by
running the <code>brctl</code> command on the host machine and looking at the
<code>interfaces</code> column of the output.  Here is a host with two different
containers connected:</p>

<pre><code># Display bridge info

$ sudo brctl show
bridge name     bridge id               STP enabled     interfaces
docker0         8000.3a1d7362b4ee       no              veth65f9
                                                        vethdda6
</code></pre>

<p>If the <code>brctl</code> command is not installed on your Docker host, then on
Ubuntu you should be able to run <code>sudo apt-get install bridge-utils</code> to
install it.</p>

<p>Finally, the <code>docker0</code> Ethernet bridge settings are used every time you
create a new container.  Docker selects a free IP address from the range
available on the bridge each time you <code>docker run</code> a new container, and
configures the container&rsquo;s <code>eth0</code> interface with that IP address and the
bridge&rsquo;s netmask.  The Docker host&rsquo;s own IP address on the bridge is
used as the default gateway by which each container reaches the rest of
the Internet.</p>

<pre><code># The network, as seen from a container

$ docker run -i -t --rm base /bin/bash

$$ ip addr show eth0
24: eth0: &lt;BROADCAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 32:6f:e0:35:57:91 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.3/16 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::306f:e0ff:fe35:5791/64 scope link
       valid_lft forever preferred_lft forever

$$ ip route
default via 172.17.42.1 dev eth0
172.17.0.0/16 dev eth0  proto kernel  scope link  src 172.17.0.3

$$ exit
</code></pre>

<p>Remember that the Docker host will not be willing to forward container
packets out on to the Internet unless its <code>ip_forward</code> system setting is
<code>1</code> — see the section above on <a href="#between-containers">Communication between
containers</a> for details.</p>

<h2 id="building-your-own-bridge">Building your own bridge</h2>

<p><a name="bridge-building"></a></p>

<p>If you want to take Docker out of the business of creating its own
Ethernet bridge entirely, you can set up your own bridge before starting
Docker and use <code>-b BRIDGE</code> or <code>--bridge=BRIDGE</code> to tell Docker to use
your bridge instead.  If you already have Docker up and running with its
old <code>docker0</code> still configured, you will probably want to begin by
stopping the service and removing the interface:</p>

<pre><code># Stopping Docker and removing docker0

$ sudo service docker stop
$ sudo ip link set dev docker0 down
$ sudo brctl delbr docker0
$ sudo iptables -t nat -F POSTROUTING
</code></pre>

<p>Then, before starting the Docker service, create your own bridge and
give it whatever configuration you want.  Here we will create a simple
enough bridge that we really could just have used the options in the
previous section to customize <code>docker0</code>, but it will be enough to
illustrate the technique.</p>

<pre><code># Create our own bridge

$ sudo brctl addbr bridge0
$ sudo ip addr add 192.168.5.1/24 dev bridge0
$ sudo ip link set dev bridge0 up

# Confirming that our bridge is up and running

$ ip addr show bridge0
4: bridge0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state UP group default
    link/ether 66:38:d0:0d:76:18 brd ff:ff:ff:ff:ff:ff
    inet 192.168.5.1/24 scope global bridge0
       valid_lft forever preferred_lft forever

# Tell Docker about it and restart (on Ubuntu)

$ echo 'DOCKER_OPTS=&quot;-b=bridge0&quot;' &gt;&gt; /etc/default/docker
$ sudo service docker start

# Confirming new outgoing NAT masquerade is set up

$ sudo iptables -t nat -L -n
...
Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination
MASQUERADE  all  --  192.168.5.0/24      0.0.0.0/0
</code></pre>

<p>The result should be that the Docker server starts successfully and is
now prepared to bind containers to the new bridge.  After pausing to
verify the bridge&rsquo;s configuration, try creating a container — you will
see that its IP address is in your new IP address range, which Docker
will have auto-detected.</p>

<p>Just as we learned in the previous section, you can use the <code>brctl show</code>
command to see Docker add and remove interfaces from the bridge as you
start and stop containers, and can run <code>ip addr</code> and <code>ip route</code> inside a
container to see that it has been given an address in the bridge&rsquo;s IP
address range and has been told to use the Docker host&rsquo;s IP address on
the bridge as its default gateway to the rest of the Internet.</p>

<h2 id="how-docker-networks-a-container">How Docker networks a container</h2>

<p><a name="container-networking"></a></p>

<p>While Docker is under active development and continues to tweak and
improve its network configuration logic, the shell commands in this
section are rough equivalents to the steps that Docker takes when
configuring networking for each new container.</p>

<p>Let&rsquo;s review a few basics.</p>

<p>To communicate using the Internet Protocol (IP), a machine needs access
to at least one network interface at which packets can be sent and
received, and a routing table that defines the range of IP addresses
reachable through that interface.  Network interfaces do not have to be
physical devices.  In fact, the <code>lo</code> loopback interface available on
every Linux machine (and inside each Docker container) is entirely
virtual — the Linux kernel simply copies loopback packets directly from
the sender&rsquo;s memory into the receiver&rsquo;s memory.</p>

<p>Docker uses special virtual interfaces to let containers communicate
with the host machine — pairs of virtual interfaces called “peers” that
are linked inside of the host machine&rsquo;s kernel so that packets can
travel between them.  They are simple to create, as we will see in a
moment.</p>

<p>The steps with which Docker configures a container are:</p>

<ol>
<li><p>Create a pair of peer virtual interfaces.</p></li>

<li><p>Give one of them a unique name like <code>veth65f9</code>, keep it inside of
the main Docker host, and bind it to <code>docker0</code> or whatever bridge
Docker is supposed to be using.</p></li>

<li><p>Toss the other interface over the wall into the new container (which
will already have been provided with an <code>lo</code> interface) and rename
it to the much prettier name <code>eth0</code> since, inside of the container&rsquo;s
separate and unique network interface namespace, there are no
physical interfaces with which this name could collide.</p></li>

<li><p>Set the interface&rsquo;s MAC address according to the <code>--mac-address</code>
parameter or generate a random one.</p></li>

<li><p>Give the container&rsquo;s <code>eth0</code> a new IP address from within the
bridge&rsquo;s range of network addresses. The default route is set to the
IP address passed to the Docker daemon using the <code>--default-gateway</code>
option if specified, otherwise to the IP address that the Docker host
owns on the bridge. The MAC address is generated from the IP address
unless otherwise specified. This prevents ARP cache invalidation
problems, when a new container comes up with an IP used in the past by
another container with another MAC.</p></li>
</ol>

<p>With these steps complete, the container now possesses an <code>eth0</code>
(virtual) network card and will find itself able to communicate with
other containers and the rest of the Internet.</p>

<p>You can opt out of the above process for a particular container by
giving the <code>--net=</code> option to <code>docker run</code>, which takes four possible
values.</p>

<ul>
<li><p><code>--net=bridge</code> — The default action, that connects the container to
the Docker bridge as described above.</p></li>

<li><p><code>--net=host</code> — Tells Docker to skip placing the container inside of
a separate network stack.  In essence, this choice tells Docker to
<strong>not containerize the container&rsquo;s networking</strong>!  While container
processes will still be confined to their own filesystem and process
list and resource limits, a quick <code>ip addr</code> command will show you
that, network-wise, they live “outside” in the main Docker host and
have full access to its network interfaces.  Note that this does
<strong>not</strong> let the container reconfigure the host network stack — that
would require <code>--privileged=true</code> — but it does let container
processes open low-numbered ports like any other root process.
It also allows the container to access local network services
like D-bus.  This can lead to processes in the container being
able to do unexpected things like
<a href="https://github.com/docker/docker/issues/6401">restart your computer</a>.
You should use this option with caution.</p></li>

<li><p><code>--net=container:NAME_or_ID</code> — Tells Docker to put this container&rsquo;s
processes inside of the network stack that has already been created
inside of another container.  The new container&rsquo;s processes will be
confined to their own filesystem and process list and resource
limits, but will share the same IP address and port numbers as the
first container, and processes on the two containers will be able to
connect to each other over the loopback interface.</p></li>

<li><p><code>--net=none</code> — Tells Docker to put the container inside of its own
network stack but not to take any steps to configure its network,
leaving you free to build any of the custom configurations explored
in the last few sections of this document.</p></li>
</ul>

<p>To get an idea of the steps that are necessary if you use <code>--net=none</code>
as described in that last bullet point, here are the commands that you
would run to reach roughly the same configuration as if you had let
Docker do all of the configuration:</p>

<pre><code># At one shell, start a container and
# leave its shell idle and running

$ docker run -i -t --rm --net=none base /bin/bash
root@63f36fc01b5f:/#

# At another shell, learn the container process ID
# and create its namespace entry in /var/run/netns/
# for the &quot;ip netns&quot; command we will be using below

$ docker inspect -f '{{.State.Pid}}' 63f36fc01b5f
2778
$ pid=2778
$ sudo mkdir -p /var/run/netns
$ sudo ln -s /proc/$pid/ns/net /var/run/netns/$pid

# Check the bridge's IP address and netmask

$ ip addr show docker0
21: docker0: ...
inet 172.17.42.1/16 scope global docker0
...

# Create a pair of &quot;peer&quot; interfaces A and B,
# bind the A end to the bridge, and bring it up

$ sudo ip link add A type veth peer name B
$ sudo brctl addif docker0 A
$ sudo ip link set A up

# Place B inside the container's network namespace,
# rename to eth0, and activate it with a free IP

$ sudo ip link set B netns $pid
$ sudo ip netns exec $pid ip link set dev B name eth0
$ sudo ip netns exec $pid ip link set eth0 address 12:34:56:78:9a:bc
$ sudo ip netns exec $pid ip link set eth0 up
$ sudo ip netns exec $pid ip addr add 172.17.42.99/16 dev eth0
$ sudo ip netns exec $pid ip route add default via 172.17.42.1
</code></pre>

<p>At this point your container should be able to perform networking
operations as usual.</p>

<p>When you finally exit the shell and Docker cleans up the container, the
network namespace is destroyed along with our virtual <code>eth0</code> — whose
destruction in turn destroys interface <code>A</code> out in the Docker host and
automatically un-registers it from the <code>docker0</code> bridge.  So everything
gets cleaned up without our having to run any extra commands!  Well,
almost everything:</p>

<pre><code># Clean up dangling symlinks in /var/run/netns

find -L /var/run/netns -type l -delete
</code></pre>

<p>Also note that while the script above used modern <code>ip</code> command instead
of old deprecated wrappers like <code>ipconfig</code> and <code>route</code>, these older
commands would also have worked inside of our container.  The <code>ip addr</code>
command can be typed as <code>ip a</code> if you are in a hurry.</p>

<p>Finally, note the importance of the <code>ip netns exec</code> command, which let
us reach inside and configure a network namespace as root.  The same
commands would not have worked if run inside of the container, because
part of safe containerization is that Docker strips container processes
of the right to configure their own networks.  Using <code>ip netns exec</code> is
what let us finish up the configuration without having to take the
dangerous step of running the container itself with <code>--privileged=true</code>.</p>

<h2 id="tools-and-examples">Tools and examples</h2>

<p>Before diving into the following sections on custom network topologies,
you might be interested in glancing at a few external tools or examples
of the same kinds of configuration.  Here are two:</p>

<ul>
<li><p>Jérôme Petazzoni has created a <code>pipework</code> shell script to help you
connect together containers in arbitrarily complex scenarios:
<a href="https://github.com/jpetazzo/pipework">https://github.com/jpetazzo/pipework</a></p></li>

<li><p>Brandon Rhodes has created a whole network topology of Docker
containers for the next edition of Foundations of Python Network
Programming that includes routing, NAT&rsquo;d firewalls, and servers that
offer HTTP, SMTP, POP, IMAP, Telnet, SSH, and FTP:
<a href="https://github.com/brandon-rhodes/fopnp/tree/m/playground">https://github.com/brandon-rhodes/fopnp/tree/m/playground</a></p></li>
</ul>

<p>Both tools use networking commands very much like the ones you saw in
the previous section, and will see in the following sections.</p>

<h2 id="building-a-point-to-point-connection">Building a point-to-point connection</h2>

<p><a name="point-to-point"></a></p>

<p>By default, Docker attaches all containers to the virtual subnet
implemented by <code>docker0</code>.  You can create containers that are each
connected to some different virtual subnet by creating your own bridge
as shown in <a href="#bridge-building">Building your own bridge</a>, starting each
container with <code>docker run --net=none</code>, and then attaching the
containers to your bridge with the shell commands shown in <a href="#container-networking">How Docker
networks a container</a>.</p>

<p>But sometimes you want two particular containers to be able to
communicate directly without the added complexity of both being bound to
a host-wide Ethernet bridge.</p>

<p>The solution is simple: when you create your pair of peer interfaces,
simply throw <em>both</em> of them into containers, and configure them as
classic point-to-point links.  The two containers will then be able to
communicate directly (provided you manage to tell each container the
other&rsquo;s IP address, of course).  You might adjust the instructions of
the previous section to go something like this:</p>

<pre><code># Start up two containers in two terminal windows

$ docker run -i -t --rm --net=none base /bin/bash
root@1f1f4c1f931a:/#

$ docker run -i -t --rm --net=none base /bin/bash
root@12e343489d2f:/#

# Learn the container process IDs
# and create their namespace entries

$ docker inspect -f '{{.State.Pid}}' 1f1f4c1f931a
2989
$ docker inspect -f '{{.State.Pid}}' 12e343489d2f
3004
$ sudo mkdir -p /var/run/netns
$ sudo ln -s /proc/2989/ns/net /var/run/netns/2989
$ sudo ln -s /proc/3004/ns/net /var/run/netns/3004

# Create the &quot;peer&quot; interfaces and hand them out

$ sudo ip link add A type veth peer name B

$ sudo ip link set A netns 2989
$ sudo ip netns exec 2989 ip addr add 10.1.1.1/32 dev A
$ sudo ip netns exec 2989 ip link set A up
$ sudo ip netns exec 2989 ip route add 10.1.1.2/32 dev A

$ sudo ip link set B netns 3004
$ sudo ip netns exec 3004 ip addr add 10.1.1.2/32 dev B
$ sudo ip netns exec 3004 ip link set B up
$ sudo ip netns exec 3004 ip route add 10.1.1.1/32 dev B
</code></pre>

<p>The two containers should now be able to ping each other and make
connections successfully.  Point-to-point links like this do not depend
on a subnet nor a netmask, but on the bare assertion made by <code>ip route</code>
that some other single IP address is connected to a particular network
interface.</p>

<p>Note that point-to-point links can be safely combined with other kinds
of network connectivity — there is no need to start the containers with
<code>--net=none</code> if you want point-to-point links to be an addition to the
container&rsquo;s normal networking instead of a replacement.</p>

<p>A final permutation of this pattern is to create the point-to-point link
between the Docker host and one container, which would allow the host to
communicate with that one container on some single IP address and thus
communicate “out-of-band” of the bridge that connects the other, more
usual containers.  But unless you have very specific networking needs
that drive you to such a solution, it is probably far preferable to use
<code>--icc=false</code> to lock down inter-container communication, as we explored
earlier.</p>

<h2 id="editing-networking-config-files">Editing networking config files</h2>

<p>Starting with Docker v.1.2.0, you can now edit <code>/etc/hosts</code>, <code>/etc/hostname</code>
and <code>/etc/resolve.conf</code> in a running container. This is useful if you need
to install bind or other services that might override one of those files.</p>

<p>Note, however, that changes to these files will not be saved by
<code>docker commit</code>, nor will they be saved during <code>docker run</code>.
That means they won&rsquo;t be saved in the image, nor will they persist when a
container is restarted; they will only &ldquo;stick&rdquo; in a running container.</p>

        </article>
		  </section>
    </div>
    <div id="toc" class="large-3 columns toc ">
     On this page:
        <nav id="TableOfContents">
<ul>
<li><a href="#network-configuration">Network configuration</a>
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#quick-guide-to-the-options">Quick guide to the options</a></li>
<li><a href="#configuring-dns">Configuring DNS</a></li>
<li><a href="#communication-between-containers-and-the-wider-world">Communication between containers and the wider world</a></li>
<li><a href="#communication-between-containers">Communication between containers</a></li>
<li><a href="#binding-container-ports-to-the-host">Binding container ports to the host</a></li>
<li><a href="#ipv6">IPv6</a>
<ul>
<li><a href="#ipv6-with-docker">IPv6 with Docker</a>
<ul>
<li><a href="#using-ndp-proxying">Using NDP proxying</a></li>
</ul></li>
<li><a href="#docker-ipv6-cluster">Docker IPv6 cluster</a>
<ul>
<li><a href="#switched-network-environment">Switched network environment</a></li>
<li><a href="#routed-network-environment">Routed network environment</a></li>
</ul></li>
</ul></li>
<li><a href="#customizing-docker0">Customizing docker0</a></li>
<li><a href="#building-your-own-bridge">Building your own bridge</a></li>
<li><a href="#how-docker-networks-a-container">How Docker networks a container</a></li>
<li><a href="#tools-and-examples">Tools and examples</a></li>
<li><a href="#building-a-point-to-point-connection">Building a point-to-point connection</a></li>
<li><a href="#editing-networking-config-files">Editing networking config files</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

<footer class="main-footer">
  <div class="row">
  </div>
  <div class="row">
  </div>
  <div id="buildinfo">
    Jul 8, 2015 at 6:45pm (PST)
        BUILD_DATA
   </div>
</footer>
<link rel="stylesheet" href="/highlight/styles/github.css">
<script src="/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/dist/assets/js/all.js"></script>
<script>
  $( 'nav li:has(ul)' ).doubleTapToGo();
</script>
<script>

;(function ( $, window, document, undefined ) {

    var pluginName = 'accordion',
        defaults = {
            transitionSpeed: 300,
            transitionEasing: 'ease',
            controlElement: '[data-control]',
            contentElement: '[data-content]',
            groupElement: '[data-accordion-group]',
            singleOpen: true
        };

    function Accordion(element, options) {
        this.element = element;
        this.options = $.extend({}, defaults, options);
        this._defaults = defaults;
        this._name = pluginName;
        this.init();
    }

    Accordion.prototype.init = function () {
        var self = this,
            opts = self.options;

        var $accordion = $(self.element),
            $controls = $accordion.find('> ' + opts.controlElement),
            $content =  $accordion.find('> ' + opts.contentElement);

        var accordionParentsQty = $accordion.parents('[data-accordion]').length,
            accordionHasParent = accordionParentsQty > 0;

        var closedCSS = { 'max-height': 0, 'overflow': 'hidden' };

        var CSStransitions = supportsTransitions();

        function debounce(func, threshold, execAsap) {
            var timeout;

            return function debounced() {
                var obj = this,
                    args = arguments;

                function delayed() {
                    if (!execAsap) func.apply(obj, args);
                    timeout = null;
                };

                if (timeout) clearTimeout(timeout);
                else if (execAsap) func.apply(obj, args);

                timeout = setTimeout(delayed, threshold || 100);
            };
        }

        function supportsTransitions() {
            var b = document.body || document.documentElement,
                s = b.style,
                p = 'transition';

            if (typeof s[p] == 'string') {
                return true;
            }

            var v = ['Moz', 'webkit', 'Webkit', 'Khtml', 'O', 'ms'];

            p = 'Transition';

            for (var i=0; i<v.length; i++) {
                if (typeof s[v[i] + p] == 'string') {
                    return true;
                }
            }

            return false;
        }

        function requestAnimFrame(cb) {
            if(window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame) {
                return  requestAnimationFrame(cb) ||
                        webkitRequestAnimationFrame(cb) ||
                        mozRequestAnimationFrame(cb);
            } else {
                return setTimeout(cb, 1000 / 60);
            }
        }

        function toggleTransition($el, remove) {
            if(!remove) {
                $content.css({
                    '-webkit-transition': 'max-height ' + opts.transitionSpeed + 'ms ' + opts.transitionEasing,
                    'transition': 'max-height ' + opts.transitionSpeed + 'ms ' + opts.transitionEasing
                });
            } else {
                $content.css({
                    '-webkit-transition': '',
                    'transition': ''
                });
            }
        }

        function calculateHeight($el) {
            var height = 0;

            $el.children().each(function() {
                height = height + $(this).outerHeight(true);
            });

            $el.data('oHeight', height);
        }

        function updateParentHeight($parentAccordion, $currentAccordion, qty, operation) {
            var $content = $parentAccordion.filter('.open').find('> [data-content]'),
                $childs = $content.find('[data-accordion].open > [data-content]'),
                $matched;

            if(!opts.singleOpen) {
                $childs = $childs.not($currentAccordion.siblings('[data-accordion].open').find('> [data-content]'));
            }

            $matched = $content.add($childs);

            if($parentAccordion.hasClass('open')) {
                $matched.each(function() {
                    var currentHeight = $(this).data('oHeight');

                    switch (operation) {
                        case '+':
                            $(this).data('oHeight', currentHeight + qty);
                            break;
                        case '-':
                            $(this).data('oHeight', currentHeight - qty);
                            break;
                        default:
                            throw 'updateParentHeight method needs an operation';
                    }

                    $(this).css('max-height', $(this).data('oHeight'));
                });
            }
        }

        function refreshHeight($accordion) {
            if($accordion.hasClass('open')) {
                var $content = $accordion.find('> [data-content]'),
                    $childs = $content.find('[data-accordion].open > [data-content]'),
                    $matched = $content.add($childs);

                calculateHeight($matched);

                $matched.css('max-height', $matched.data('oHeight'));
            }
        }

        function closeAccordion($accordion, $content) {
            $accordion.trigger('accordion.close');
            
            if(CSStransitions) {
                if(accordionHasParent) {
                    var $parentAccordions = $accordion.parents('[data-accordion]');

                    updateParentHeight($parentAccordions, $accordion, $content.data('oHeight'), '-');
                }

                $content.css(closedCSS);

                $accordion.removeClass('open');
            } else {
                $content.css('max-height', $content.data('oHeight'));

                $content.animate(closedCSS, opts.transitionSpeed);

                $accordion.removeClass('open');
            }
        }

        function openAccordion($accordion, $content) {
            $accordion.trigger('accordion.open');
            if(CSStransitions) {
                toggleTransition($content);

                if(accordionHasParent) {
                    var $parentAccordions = $accordion.parents('[data-accordion]');

                    updateParentHeight($parentAccordions, $accordion, $content.data('oHeight'), '+');
                }

                requestAnimFrame(function() {
                    $content.css('max-height', $content.data('oHeight'));
                });

                $accordion.addClass('open');
            } else {
                $content.animate({
                    'max-height': $content.data('oHeight')
                }, opts.transitionSpeed, function() {
                    $content.css({'max-height': 'none'});
                });

                $accordion.addClass('open');
            }
        }

        function closeSiblingAccordions($accordion) {
            var $accordionGroup = $accordion.closest(opts.groupElement);

            var $siblings = $accordion.siblings('[data-accordion]').filter('.open'),
                $siblingsChildren = $siblings.find('[data-accordion]').filter('.open');

            var $otherAccordions = $siblings.add($siblingsChildren);

            $otherAccordions.each(function() {
                var $accordion = $(this),
                    $content = $accordion.find(opts.contentElement);

                closeAccordion($accordion, $content);
            });

            $otherAccordions.removeClass('open');
        }

        function toggleAccordion() {
            var isAccordionGroup = (opts.singleOpen) ? $accordion.parents(opts.groupElement).length > 0 : false;

            calculateHeight($content);

            if(isAccordionGroup) {
                closeSiblingAccordions($accordion);
            }

            if($accordion.hasClass('open')) {
                closeAccordion($accordion, $content);
            } else {
                openAccordion($accordion, $content);
            }
        }

        function addEventListeners() {
            $controls.on('click', toggleAccordion);
            
            $controls.on('accordion.toggle', function() {
                if(opts.singleOpen && $controls.length > 1) {
                    return false;
                }
                
                toggleAccordion();
            });

            $(window).on('resize', debounce(function() {
                refreshHeight($accordion);
            }));
        }

        function setup() {
            $content.each(function() {
                var $curr = $(this);

                if($curr.css('max-height') != 0) {
                    if(!$curr.closest('[data-accordion]').hasClass('open')) {
                        $curr.css({ 'max-height': 0, 'overflow': 'hidden' });
                    } else {
                        toggleTransition($curr);
                        calculateHeight($curr);

                        $curr.css('max-height', $curr.data('oHeight'));
                    }
                }
            });


            if(!$accordion.attr('data-accordion')) {
                $accordion.attr('data-accordion', '');
                $accordion.find(opts.controlElement).attr('data-control', '');
                $accordion.find(opts.contentElement).attr('data-content', '');
            }
        }

        setup();
        addEventListeners();
    };

    $.fn[pluginName] = function ( options ) {
        return this.each(function () {
            if (!$.data(this, 'plugin_' + pluginName)) {
                $.data(this, 'plugin_' + pluginName,
                new Accordion( this, options ));
            }
        });
    }

})( jQuery, window, document );

$(document).ready(function() {
  $('#multiple [data-accordion]').accordion({
    singleOpen: false
  });
});

</script>


<script src="/dist/assets/js/bootstrap-3.0.3.min.js"></script>
<script src="/dist/assets/js/archive.js"></script>
  <script type="text/javascript">
	  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
	  analytics.load("IWj9D0UpZHZdZUZX9jl98PcpBFWBnBMy");
	  analytics.page();
	  }}();
	</script>

